import streamlit as st
from datetime import date
from collections import Counter
import time
import random

# 1. é¡µé¢é…ç½® (å¿…é¡»æ”¾åœ¨æœ€é¡¶ç«¯)
st.set_page_config(page_title="Aroma's Secret Lab", layout="centered")

# ==========================================
# æ•°æ®åº“ Aï¼š78 ç§é¦™å‘³ä¸æ„Ÿæ€§æè¿°
# ==========================================
scent_map = {
    # --- å‰è°ƒ (Top Notes) - å…± 20 ç§ ---
    "å‰è°ƒ èŠ³é¦™ 01": "å¯Œå®¶åƒé‡‘ (å°è±†è”»/ä¹Œé¾™èŒ¶)",
    "å‰è°ƒ èŠ³é¦™ 02": "å¤å¤©çš„é£ (ç½—å‹’/ç™¾é‡Œé¦™)",
    "å‰è°ƒ èŠ³é¦™ 03": "é‡èŠ± (å°è±†è”»/å«ç¾è‰)",
    "å‰è°ƒ èŠ³é¦™ 04": "è‚†æ„å¥”æ”¾ (å°è±†è”»/é©¬éƒå…°)",
    "å‰è°ƒ èŠ³é¦™ 05": "ä¹¡æ„ (æ €å­èŠ±/ç»¿å¶/ç”˜è‰)",
    "å‰è°ƒ èŠ³é¦™ 06": "èŒ¶æ ‘ (èŒ¶æ ‘)",
    "å‰è°ƒ èŠ³é¦™ 07": "è–„è· (è–„è·)",
    "å‰è°ƒ èŠ³é¦™ 08": "é©¬é­è‰ (é©¬é­è‰)",
    "å‰è°ƒ èŠ³é¦™ 09": "ç»¿èŒ¶ (ç»¿èŒ¶)",
    "å‰è°ƒ æŸ‘æ©˜ 01": "èŠ±å›­ (æ©˜å­/æŸ æª¬/å¼€å¿ƒæœ)",
    "å‰è°ƒ æŸ‘æ©˜ 02": "è®°å¿†èœœç³– (æ©˜å­/æ¡ƒå­)",
    "å‰è°ƒ æŸ‘æ©˜ 03": "å¯‚é™ç§‹å¤œ (èƒ¡èåœ/ç•ªèŒ„/æ©™å­)",
    "å‰è°ƒ æŸ‘æ©˜ 04": "æ°”æ³¡æ°´ (è‘¡è„æŸš/æ©˜å­)",
    "å‰è°ƒ æŸ‘æ©˜ 05": "æµ·è¾¹æ¼«æ­¥ (æ©™å­/æŸ æª¬)",
    "å‰è°ƒ æŸ‘æ©˜ 06": "æµ·æ»© (ä½›æ‰‹æŸ‘/æŸ æª¬/é¦™æ©™)",
    "å‰è°ƒ æŸ‘æ©˜ 07": "çº¯çœŸ (æ©™å­/èŒ‰è‰/ç¥ç€)",
    "å‰è°ƒ æŸ‘è‹” 01": "æ™¨é—´æ£®æ— (æ— èŠ±æœæœ¨/é¦™æ ¹è‰)",
    "å‰è°ƒ æŸ‘è‹” 02": "ä¿¡ä»° (æ©˜å­/éºé¦™/è‹¦æ©™å¶)",
    "å‰è°ƒ æŸ‘è‹” 03": "æ¸…æ–° (è‘¡è„æŸš/æ©¡æœ¨è‹”)",
    "å‰è°ƒ æŸ‘è‹” 04": "è‹”è—“ (è‹”è—“)",

    # --- ä¸­è°ƒ (Middle Notes) - å…± 34 ç§ ---
    "ä¸­è°ƒ æœé¦™ 01": "å¤æ—¥åº„å›­ (æŸ‘æ©˜/æ— èŠ±æœ)",
    "ä¸­è°ƒ æœé¦™ 02": "çº¯ç²¹ (é¦™ç“œ/æ©˜å­/é»„ç“œ)",
    "ä¸­è°ƒ æœé¦™ 03": "ç”œç¾ (è‰è“/æ¢¨/èœœæ©˜)",
    "ä¸­è°ƒ æœé¦™ 04": "æƒ…çª¦åˆå¼€ (çº¢æµ†æœ/ç³–)",
    "ä¸­è°ƒ æœé¦™ 05": "æ’’ä¸å²› (æ©™èŠ±æ²¹/æŸ æª¬)",
    "ä¸­è°ƒ æœé¦™ 06": "ä»²å¤èŠ±å›­ (çº¢è‹¹æœ/ç«ç‘°)",
    "ä¸­è°ƒ æœé¦™ 07": "é…¸ç”œè½¯å¦¹ (é»‘åŠ ä»‘/è è/ç„¦ç³–)",
    "ä¸­è°ƒ æœé¦™ 08": "åœ°ä¸­æµ· (é¦™è±Œè±†/æŸ æª¬/ç„¦ç³–)",
    "ä¸­è°ƒ æœé¦™ 09": "æµ·è¾¹å¾®é£ (é»„è‘µ/ç›)",
    "ä¸­è°ƒ æœé¦™ 10": "å’–å•¡å… (ç”œè‹¹æœ/é¦™æ©™èŠ±/é¦™è‰)",
    "ä¸­è°ƒ æœé¦™ 11": "æŸ‘æ©˜ (æŸ‘æ©˜)",
    "ä¸­è°ƒ æœé¦™ 12": "æŸ æª¬ (æŸ æª¬)",
    "ä¸­è°ƒ æœé¦™ 13": "ç™¾é¦™æœ (ç™¾é¦™æœ)",
    "ä¸­è°ƒ æœé¦™ 14": "é’ç“œ (é’ç“œ)",
    "ä¸­è°ƒ æœé¦™ 15": "é’è‹¹æœ (é’è‹¹æœ)",
    "ä¸­è°ƒ èŠ±é¦™ 01": "ç™½è¡¬è¡« (è–°è¡£è‰/æ©™èŠ±)",
    "ä¸­è°ƒ èŠ±é¦™ 02": "ä¼˜é›…å¥³äºº (æ™šé¦™ç‰/èŒ‰è‰èŠ±)",
    "ä¸­è°ƒ èŠ±é¦™ 03": "é›¨åèŠ±å›­ (ç«ç‘°/ä¾å…°)",
    "ä¸­è°ƒ èŠ±é¦™ 04": "é™è°§èŠ±å›­ (ç«ç‘°/èŒ‰è‰)",
    "ä¸­è°ƒ èŠ±é¦™ 05": "åˆæ˜¥ (ç«ç‘°/èœ‚èœœ)",
    "ä¸­è°ƒ èŠ±é¦™ 06": "æ˜¥æ„ç›ç„¶ (èŒ‰è‰/ç»¿å¶)",
    "ä¸­è°ƒ èŠ±é¦™ 07": "æ¢¨å­é…’ (æ¢¨/å°è‹å…°)",
    "ä¸­è°ƒ èŠ±é¦™ 08": "æ£®æ—å°å±‹ (è–°è¡£è‰/è‚‰è±†è”»)",
    "ä¸­è°ƒ èŠ±é¦™ 09": "ç¨»é¦™ (æ©™èŠ±/é¦™è‰)",
    "ä¸­è°ƒ èŠ±é¦™ 10": "å¼‚åŸŸé£æƒ… (æ™šé¦™ç‰/ä¾å…°)",
    "ä¸­è°ƒ èŠ±é¦™ 11": "ä¼˜é›… (èŒ‰è‰/å…°èŠ±/æå­)",
    "ä¸­è°ƒ èŠ±é¦™ 12": "è–°è¡£è‰ (è–°è¡£è‰)",
    "ä¸­è°ƒ èŠ±é¦™ 13": "å¤œæ¥é¦™ (å¤œæ¥é¦™)",
    "ä¸­è°ƒ èŠ±é¦™ 14": "æ €å­èŠ± (æ €å­èŠ±)",
    "ä¸­è°ƒ èŠ±é¦™ 15": "ä¾å…° (ä¾å…°)",
    "ä¸­è°ƒ èŠ±é¦™ 16": "ç«ç‘° (ç«ç‘°)",
    "ä¸­è°ƒ èŠ±é¦™ 17": "é£é“ƒè‰ (é£é“ƒè‰)",
    "ä¸­è°ƒ èŠ±é¦™ 18": "èŒ‰è‰ (èŒ‰è‰)",
    "ä¸­è°ƒ èŠ±é¦™ 19": "æ¡‚èŠ± (æ¡‚èŠ±)",

    # --- åè°ƒ (Base Notes) - å…± 24 ç§ ---
    "åè°ƒ ä¸œæ–¹ 01": "é›¨è½å¹½ç„¶ (è‹¦æ©™/ç¥ç€)",
    "åè°ƒ ä¸œæ–¹ 02": "ä¹Œé¾™èŒ¶ (èŒ¶å¶/é¦™æ ¹è‰)",
    "åè°ƒ ä¸œæ–¹ 03": "æ–°ä¼¦æ•¦ç”· (è‚‰æ¡‚/çƒŸè‰/æ©¡æœ¨è‹”)",
    "åè°ƒ ä¸œæ–¹ 04": "å¤è€ä¹¦åº— (å†¬åŠ è±†)",
    "åè°ƒ ä¸œæ–¹ 05": "è¥¿è¥¿é‡Œå²› (æä»/é¦™è‰/éºé¦™)",
    "åè°ƒ ä¸œæ–¹ 06": "é˜³å…‰ (ç´«ç½—å…°/é¦™è‰/éºé¦™)",
    "åè°ƒ ä¸œæ–¹ 07": "é«˜å±±å¾®é£ (è¿·è¿­é¦™/å¹¿è—¿é¦™)",
    "åè°ƒ ä¸œæ–¹ 08": "å†¬æ—¥å£ç‚‰ (ç¥ç€/éºé¦™)",
    "åè°ƒ ä¸œæ–¹ 09": "è·å°”è’™ (èŠ±æ¤’/å¹¿è—¿é¦™)",
    "åè°ƒ ä¸œæ–¹ 10": "æ³•å›½ç»…å£« (æ©˜å­/æª€é¦™æœ¨)",
    "åè°ƒ ä¸œæ–¹ 11": "æ¢…ç³– (æ¢¨/æä»/é¦™è‰)",
    "åè°ƒ æœ¨è´¨ 01": "å†¬æ—¥æ¾æ— (é›ªæ¾/éºé¦™)",
    "åè°ƒ æœ¨è´¨ 02": "æ²‰é™æ£®æ— (ç™½æ¾é¦™/æª€é¦™)",
    "åè°ƒ æœ¨è´¨ 03": "æ²‰ç¨³ (èè½/é¦™æ ¹è‰/é›ªæ¾æœ¨)",
    "åè°ƒ æœ¨è´¨ 04": "é¾™æ¶ (é¾™æ¶/ç¥ç€/æœ¨è´¨)",
    "åè°ƒ æœ¨è´¨ 05": "é›ªæ¾ (é›ªæ¾)",
    "åè°ƒ æœ¨è´¨ 06": "ç©ºçµ (éºé¦™/æ²‰é¦™)",
    "åè°ƒ æœ¨è´¨ 07": "æ™¨é—´å±±é£ (é¦™è‰/æ²‰é¦™)",
    "åè°ƒ æœ¨è´¨ 08": "å¯ºåº™ (é»‘èƒ¡æ¤’/æª€æœ¨)",
    "åè°ƒ æœ¨è´¨ 09": "äº‘é›¾ (è¿·è¿­é¦™/æ¨Ÿæœ¨)",
    "åè°ƒ æœ¨è´¨ 10": "æ•…ä¹¡ (æ²‰é¦™/å¹¿è—¿é¦™)",
    "åè°ƒ æœ¨è´¨ 11": "ç„šé¦™ (æ²‰é¦™/å·´è¥¿çº¢æœ¨)",
    "åè°ƒ æœ¨è´¨ 12": "æœˆå…‰æŸæœ¨ (è‹¦æ©™/æŸæ ‘)",
    "åè°ƒ æœ¨è´¨ 13": "æª€é¦™ (æª€é¦™)"
}
scent_descriptions = {
    # --- å‰è°ƒ (Top Notes) ---
    "å‰è°ƒ èŠ³é¦™ 01": "æ¸…å†·ä¹Œé¾™ä¸è¾›é¦™å°è±†è”»ç¢°æ’ï¼Œä»¿ä½›åœ¨é›¾æ°”ç¼­ç»•çš„æ¸…æ™¨èŒ¶å±±ä¸­ç‹¬åã€‚",
    "å‰è°ƒ èŠ³é¦™ 02": "æ¸…æ–°çš„ç½—å‹’ä¸ç™¾é‡Œé¦™äº¤ç»‡ï¼Œå¦‚åŒæ¼«æ­¥åœ¨æ´’æ»¡åˆåé˜³å…‰çš„æ¬§å¼é¦™è‰å›­ã€‚",
    "å‰è°ƒ èŠ³é¦™ 03": "å«ç¾è‰çš„ç²‰æ„Ÿä¸å°è±†è”»çš„æš–æ„ï¼Œåƒæ˜¯è¸å…¥ä¸€ç‰‡å¼€æ»¡æ— åé‡èŠ±çš„é™è°§è’é‡ã€‚",
    "å‰è°ƒ èŠ³é¦™ 04": "é©¬éƒå…°çš„è¯è‰æ°”æ¯å¸¦åŠ¨æ„Ÿæ€§ï¼Œæ•£å‘å‡ºä¸€ç§æ— æ‹˜æ— æŸã€è‚†æ„å¥”æ”¾çš„è‡ªç”±æ„Ÿã€‚",
    "å‰è°ƒ èŠ³é¦™ 05": "æ €å­èŠ±çš„æ´ç™½ä¸ç»¿å¶çš„æ¸…è‹¦ï¼Œå‹¾èµ·è®°å¿†ä¸­é‚£æŠ¹æ·¡æ·¡çš„ã€å¸¦æœ‰è‰æœ¨é¦™çš„ä¹¡æ„ã€‚",
    "å‰è°ƒ èŠ³é¦™ 06": "å¼ºåŠ²çš„èŒ¶æ ‘æ°”æ¯ï¼Œåƒæ˜¯é›¨åæ£®æ—èˆ¬æ¸…å†½ï¼Œå¸¦ç»™çµé­‚æœ€å½»åº•çš„å‡€åŒ–ä¸è‹é†’ã€‚",
    "å‰è°ƒ èŠ³é¦™ 07": "æè‡´æ¸…å‡‰çš„è–„è·ï¼Œç¬é—´ç‚¹ç‡ƒæ„Ÿå®˜ï¼Œä»¿ä½›åœ¨ç‚çƒ­å¤æ—¥å–ä¸‹ä¸€å£å†°é•‡æ³‰æ°´ã€‚",
    "å‰è°ƒ èŠ³é¦™ 08": "é©¬é­è‰çš„æŸ æª¬æ¸…é¦™ï¼Œå¸¦æ¥è½»ç›ˆè·³è·ƒçš„æ´»åŠ›ï¼Œè®©å¿ƒæƒ…éšä¹‹é£æ‰¬ã€‚",
    "å‰è°ƒ èŠ³é¦™ 09": "ä¼˜é›…çš„ç»¿èŒ¶æ¸…èŠ¬ï¼Œå¦‚åŒç»†é›¨è¿‡åçš„ç«¹æ—ï¼Œå®‰é™ã€å†…æ•›ä¸”å……æ»¡ç¦…æ„ã€‚",
    "å‰è°ƒ æŸ‘æ©˜ 01": "æ©˜å­ä¸æŸ æª¬çš„é…¸ç”œï¼Œä¼´éšå¼€å¿ƒæœçš„å¾®é¦™ï¼Œåƒæ˜¯ä¸€åœºè‰²å½©ç¼¤çº·çš„èŠ±å›­æ´¾å¯¹ã€‚",
    "å‰è°ƒ æŸ‘æ©˜ 02": "å¤šæ±çš„æ¡ƒå­èå…¥æŸ‘æ©˜ï¼Œè¥é€ å‡ºè¢«èœœç³–åŒ…è£¹çš„ç«¥å¹´è®°å¿†ï¼Œç”œè€Œä¸è…»ã€‚",
    "å‰è°ƒ æŸ‘æ©˜ 03": "èƒ¡èåœä¸æ©™å­çš„å¥‡å¦™ç»“åˆï¼Œå¦‚åŒåœ¨ç§‹æ—¥çš„å¯‚é™é»„æ˜ï¼Œçœ‹è½å¶é“ºæ»¡å¤§åœ°ã€‚",
    "å‰è°ƒ æŸ‘æ©˜ 04": "æ¸…çˆ½å–·æ¶Œçš„è‘¡è„æŸšæ°”æ³¡ï¼Œå……æ»¡çˆ†å‘åŠ›çš„é…¸ç”œï¼Œç¬é—´ææŒ¯ç²¾ç¥ã€‚",
    "å‰è°ƒ æŸ‘æ©˜ 05": "æ²äººå¿ƒè„¾çš„æ¸…çˆ½æŸ‘æ©˜ï¼Œä»¿ä½›å…‰è‘—è„šåœ¨æµ·è¾¹æ¼«æ­¥ï¼Œæ„Ÿå—æµªèŠ±è½»æ‹è„šè¸ã€‚",
    "å‰è°ƒ æŸ‘æ©˜ 06": "ä½›æ‰‹æŸ‘çš„è½»ç›ˆä¸æŸ æª¬çš„æµ·é£æ„Ÿï¼Œè®©æ€ç»ªé£˜å‘é¥è¿œçš„åœ°ä¸­æµ·æ²™æ»©ã€‚",
    "å‰è°ƒ æŸ‘æ©˜ 07": "æ©˜å­ä¸çº¯çœŸèŒ‰è‰çš„é‚‚é€…ï¼Œåƒæ˜¯å¾®é£ä¸­æ‘‡æ›³çš„ç™½è‰²è£™æ‘†ï¼Œçº¯å‡€ä¸”åŠ¨äººã€‚",
    "å‰è°ƒ æŸ‘è‹” 01": "æ— èŠ±æœæœ¨ä¸é¦™æ ¹è‰çš„ç»“åˆï¼Œå¦‚åŒæ¸…æ™¨èµ°è¿›åŸå§‹æ£®æ—ï¼Œè„šä¸‹æ˜¯æ½®æ¹¿çš„æ³¥åœŸã€‚",
    "å‰è°ƒ æŸ‘è‹” 02": "è‹¦æ©™å¶ä¸éºé¦™çš„æ·±å±‚å…±é¸£ï¼Œä»£è¡¨ä¸€ç§å†…åœ¨çš„åšå®šï¼Œå¦‚åŒæœåœ£è€…çš„ä¿¡ä»°ã€‚",
    "å‰è°ƒ æŸ‘è‹” 03": "æ©¡æœ¨è‹”ä¸è‘¡è„æŸšçš„å†·é™æ„Ÿï¼Œåƒæ˜¯ä¸€é˜µç©¿é€è¿·é›¾çš„æ¸…é¦™ï¼Œå¸¦æ¥æè‡´çš„æ¸…é†’ã€‚",
    "å‰è°ƒ æŸ‘è‹” 04": "æ½®æ¹¿çš„è‹”è—“æ°”æ¯ï¼Œå¸¦æœ‰ä¸€ä¸æ³¥åœŸçš„èŠ¬èŠ³ï¼Œè®©äººä¸è‡ªè§‰åœ°å‘å¤§è‡ªç„¶æ·±å¤„æ¢ç´¢ã€‚",

    # --- ä¸­è°ƒ (Middle Notes) ---
    "ä¸­è°ƒ æœé¦™ 01": "æŸ‘æ©˜ä¸æ— èŠ±æœçš„æš–ç”œï¼Œä»¿ä½›ç½®èº«äºå—æ³•åº„å›­ï¼Œäº«å—æ‚ é—²çš„åˆåæ—¶å…‰ã€‚",
    "ä¸­è°ƒ æœé¦™ 02": "ç”œç¾çš„é¦™ç“œä¸æ¸…å‡‰é»„ç“œï¼Œçº¯ç²¹å¾—ä¸å¸¦ä¸€ä¸æ‚è´¨ï¼Œè®©æ„Ÿå®˜ç¬é—´é™æ¸©ã€‚",
    "ä¸­è°ƒ æœé¦™ 03": "è‰è“ä¸èœœæ©˜çš„é¦™ç”œï¼Œåƒæ˜¯åˆæ‹æ—¶å’¬ä¸‹çš„ç¬¬ä¸€å£æ°´æœç³–ï¼Œæ»¡å£èŠ³ç”œã€‚",
    "ä¸­è°ƒ æœé¦™ 04": "çº¢æµ†æœçš„é…¸ç”œä¸ç³–åˆ†çš„ç»“åˆï¼Œè°±å†™å‡ºä¸€æ›²å…³äºæƒ…çª¦åˆå¼€çš„ç”œèœœä¹ç« ã€‚",
    "ä¸­è°ƒ æœé¦™ 05": "æ©™èŠ±æ²¹ä¸æŸ æª¬çš„æ¸…å†½ï¼Œå¸¦æ‚¨é£å‘æ’’ä¸å²›ï¼Œæ„Ÿå—æµ·é£ä¸­çš„æ¸…çˆ½æœå‘³ã€‚",
    "ä¸­è°ƒ æœé¦™ 06": "çº¢è‹¹æœä¸ç«ç‘°çš„äº¤èï¼Œå¦‚åŒåœ¨ä»²å¤çš„èŠ±å›­ä¸­ï¼Œé‚‚é€…æœ€ç¿çƒ‚çš„ç››æ”¾ã€‚",
    "ä¸­è°ƒ æœé¦™ 07": "é»‘åŠ ä»‘ä¸è èçš„å¥”æ”¾ï¼Œå¸¦æœ‰ä¸€ç‚¹ç„¦ç³–çš„ç”œæ¶¦ï¼Œå±•ç°å‡ºé…¸ç”œè½¯å¦¹çš„ä¿çš®æ„Ÿã€‚",
    "ä¸­è°ƒ æœé¦™ 08": "é¦™è±Œè±†ä¸ç„¦ç³–çš„å±‚æ¬¡æ„Ÿï¼Œåƒæ˜¯åœ°ä¸­æµ·é˜³å…‰ä¸‹çš„åˆåèŒ¶ç‚¹ï¼Œæ…µæ‡’è€Œæ»¡è¶³ã€‚",
    "ä¸­è°ƒ æœé¦™ 09": "é»„è‘µä¸ç›çš„ç»“åˆï¼Œå¦‚åŒæµ·è¾¹æ‹‚è¿‡çš„å¾®é£ï¼Œå¸¦æœ‰ä¸€ä¸ä¸éœ²ç—•è¿¹çš„è¿·äººé­…åŠ›ã€‚",
    "ä¸­è°ƒ æœé¦™ 10": "é¦™æ©™èŠ±ä¸é¦™è‰äº¤ç»‡å‡ºçš„æ¸©æš–ç”œé¦™ï¼Œä»¿ä½›å†¬æ—¥åˆåï¼Œååœ¨å¼¥æ¼«é¦™æ°”çš„å’–å•¡å…ã€‚",
    "ä¸­è°ƒ èŠ±é¦™ 01": "è–°è¡£è‰ä¸æ©™èŠ±çš„æ´å‡€ï¼Œåƒæ˜¯ä¸€ä»¶åˆšåœ¨é˜³å…‰ä¸‹æ™¾å¹²çš„ç™½è¡¬è¡«ï¼Œè®©äººå€æ„Ÿèˆ’å¿ƒã€‚",
    "ä¸­è°ƒ èŠ±é¦™ 02": "æ™šé¦™ç‰ä¸èŒ‰è‰çš„æµ“éƒèŠ±é¦™ï¼Œè‡ªä¿¡è€Œä¼˜é›…ï¼Œç»½æ”¾å‡ºæˆç†Ÿå¥³æ€§çš„è¿·äººå…‰å½©ã€‚",
    "ä¸­è°ƒ èŠ±é¦™ 03": "ç«ç‘°ä¸ä¾å…°åœ¨é›¨åæ¹¿æ¶¦çš„æ°”æ¯ä¸­ç»½æ”¾ï¼Œå¦‚åŒèµ°å…¥ä¸€åº§ç¥ç§˜ä¸”å¹½é™çš„åº­å›­ã€‚",
    "ä¸­è°ƒ èŠ±é¦™ 04": "ç«ç‘°ä¸èŒ‰è‰çš„ç»å…¸ç»“åˆï¼Œå®‰é™åœ°ç››å¼€åœ¨å¿ƒç”°ï¼Œè¥é€ å‡ºä¸€ä»½å†…å¿ƒçš„é™è°§ã€‚",
    "ä¸­è°ƒ èŠ±é¦™ 05": "èœ‚èœœåŒ…è£¹è‘—åˆæ˜¥çš„ç«ç‘°ï¼ŒæŸ”æƒ…ä¼¼æ°´ï¼Œç¼“ç¼“é‡Šæ”¾å‡ºæ˜¥å¤©æœ€æ¸©æŸ”çš„è®¯æ¯ã€‚",
    "ä¸­è°ƒ èŠ±é¦™ 06": "èŒ‰è‰ä¸ç¿ ç»¿å¶ç‰‡çš„æ°”æ¯ï¼Œç”Ÿæœºç›ç„¶ï¼Œä»¿ä½›çœ‹è§æ˜¥èŠ½åœ¨æå¤´è½»è½»é¢¤åŠ¨ã€‚",
    "ä¸­è°ƒ èŠ±é¦™ 07": "æ¢¨ä¸å°è‹å…°äº¤ç»‡å‡ºçš„å¾®é†ºæ°”æ¯ï¼Œåƒæ˜¯å€’å‡ºä¸€æ¯æ¸…é€çš„æ¢¨å­é…’ï¼Œæ™¶è¹åŠ¨äººã€‚",
    "ä¸­è°ƒ èŠ±é¦™ 08": "è–°è¡£è‰ä¸è‚‰è±†è”»çš„æ¸©æš–è¾›é¦™ï¼Œå¦‚åŒèº²è¿›å¤§é›ªä¸­çš„æ£®æ—å°å±‹ï¼Œç‚‰ç«æ­£æ—ºã€‚",
    "ä¸­è°ƒ èŠ±é¦™ 09": "æ©™èŠ±ä¸é¦™è‰çš„æ¸…ç”œï¼Œå¸¦æœ‰ä¸€ä¸ç¨»ç±³çš„æ¸©æ¶¦æ„Ÿï¼Œæ˜¯ä¸°æ”¶å­£èŠ‚æœ€å®‰å¿ƒçš„é—®å€™ã€‚",
    "ä¸­è°ƒ èŠ±é¦™ 10": "ä¾å…°ä¸æ™šé¦™ç‰çš„å¼‚å›½é£æƒ…ï¼Œç¥ç§˜ä¸”å¤§èƒ†ï¼Œé¢†æ‚¨è¸ä¸Šä¸€åœºåä¸½çš„å†’é™©ä¹‹æ—…ã€‚",
    "ä¸­è°ƒ èŠ±é¦™ 11": "å…°èŠ±ä¸æå­çš„äº¤ç»‡ï¼Œä¼˜é›…è€Œä¸å¤±çµåŠ¨ï¼Œåœ¨ä¸¾æ‰‹æŠ•è¶³é—´æµéœ²å‡ºé«˜çº§è´¨æ„Ÿã€‚",
    "ä¸­è°ƒ èŠ±é¦™ 19": "æ¸…ç”œå…¥éª¨çš„æ¡‚èŠ±é¦™ï¼Œä»¿ä½›åœ¨æŸä¸ªç§‹å¤œçš„è¡—è§’ï¼Œå¶é‡äº†ä¸€åœºå…³äºæœˆå…‰çš„æ¢¦ã€‚",

    # --- åè°ƒ (Base Notes) ---
    "åè°ƒ ä¸œæ–¹ 01": "è‹¦æ©™ä¸ç¥ç€çš„ç¢°æ’ï¼Œå¦‚åŒç»†é›¨è½ä¸‹åçš„å¹½ç„¶æ£®æ—ï¼Œå¸¦è‘—ç¥ç§˜çš„æš–æ„ã€‚",
    "åè°ƒ ä¸œæ–¹ 02": "èŒ¶å¶ä¸é¦™æ ¹è‰çš„äº¤èï¼Œå¸¦æœ‰ä¸€ç§æ²‰æ·€è¿‡åçš„æ–‡é›…ï¼Œæ˜¯çµé­‚æ·±å¤„çš„å†·é™ã€‚",
    "åè°ƒ ä¸œæ–¹ 03": "è‚‰æ¡‚ä¸çƒŸè‰çš„æˆç†ŸéŸµå‘³ï¼Œå¦‚åŒåœ¨ä¼¦æ•¦è¡—å¤´æ¼«æ­¥çš„é«˜é›…ç”·å£«ï¼Œä»å®¹ä¸”è‡ªä¿¡ã€‚",
    "åè°ƒ ä¸œæ–¹ 04": "å†¬åŠ è±†çš„é†‡åšæ°”æ¯ï¼Œåƒæ˜¯èµ°è¿›ä¸€é—´å¡æ»¡æ—§ä¹¦çš„è€ä¹¦åº—ï¼Œæ—¶é—´åœ¨æ­¤å‡å›ºã€‚",
    "åè°ƒ ä¸œæ–¹ 05": "æä»ã€é¦™è‰ä¸éºé¦™çš„åŒ…è£¹ï¼Œå¦‚åŒè¥¿è¥¿é‡Œå²›çš„æš–é˜³ï¼Œæ¸©æ¶¦è€Œä»¤äººé™¶é†‰ã€‚",
    "åè°ƒ ä¸œæ–¹ 06": "ç´«ç½—å…°ä¸é¦™è‰çš„è½»æŸ”å‘¼å¸ï¼Œåƒæ˜¯åœ¨é˜³å…‰ä¸‹èˆ’å±•èº«ä½“ï¼Œæ„Ÿå—ç”Ÿå‘½æœ€æŸ”è½¯çš„æ—¶åˆ»ã€‚",
    "åè°ƒ ä¸œæ–¹ 07": "è¿·è¿­é¦™ä¸å¹¿è—¿é¦™çš„äº¤ç¼ ï¼Œå¦‚é«˜å±±é¡¶å³°æ è¿‡çš„ç–¾é£ï¼Œæ¸…æ¾ˆä¸”å…·æœ‰ç©¿é€åŠ›ã€‚",
    "åè°ƒ ä¸œæ–¹ 08": "ç¥ç€ä¸éºé¦™è¥é€ å‡ºç‚‰ç«èˆ¬çš„æ¸©åº¦ï¼Œå¦‚åŒåœ¨å¯’å†¬ä¸­ï¼Œé è¿‘æœ€æ¸©æš–çš„å£ç‚‰ã€‚",
    "åè°ƒ ä¸œæ–¹ 09": "èŠ±æ¤’çš„å¾®è¾›ä¸å¹¿è—¿é¦™çš„æ·±æ²‰ï¼Œé‡Šæ”¾å‡ºå¼ºçƒˆçš„è·å°”è’™æ„Ÿï¼Œå±é™©ä¸”è¯±äººã€‚",
    "åè°ƒ ä¸œæ–¹ 10": "æ©˜å­ä¸æª€é¦™æœ¨çš„ä¼˜é›…ç»“åˆï¼Œæ˜¯ä¸€ä½é£åº¦ç¿©ç¿©çš„æ³•å›½ç»…å£«ï¼Œä½è°ƒä¸”å°Šè´µã€‚",
    "åè°ƒ ä¸œæ–¹ 11": "æ¢¨ä¸é¦™è‰çš„ç”œç³¯æ„Ÿï¼Œåƒæ˜¯ç«¥å¹´æœ€çˆ±çš„é‚£é¢—æ¢…ç³–ï¼Œåœ¨èˆŒå°–ç¼“ç¼“åŒ–å¼€ã€‚",
    "åè°ƒ æœ¨è´¨ 01": "é›ªæ¾ä¸éºé¦™çš„å†·æš–å¯¹æ¯”ï¼Œå¦‚åŒé“¶è£…ç´ è£¹çš„æ¾æ—ï¼Œæ¸…å†·è€Œåˆé€è‘—ç”Ÿæœºã€‚",
    "åè°ƒ æœ¨è´¨ 02": "ç™½æ¾é¦™ä¸æª€é¦™çš„æ²ˆé™ï¼Œå¦‚åŒè¿›å…¥ä¸€ç‰‡æ— äººæ‰“æ‰°çš„æ£®æ—æ·±å¤„ï¼Œå‘¼å¸è‘—è‡ªç”±ã€‚",
    "åè°ƒ æœ¨è´¨ 03": "é¦™æ ¹è‰ä¸é›ªæ¾çš„æ‰å®æ„Ÿï¼Œèµ‹äºˆå¿ƒçµä¸€ç§æ— ä¸ä¼¦æ¯”çš„æ²‰ç¨³ä¸å®šåŠ›ã€‚",
    "åè°ƒ æœ¨è´¨ 04": "é¾™æ¶ä¸ç¥ç€çš„äº¤ç»‡ï¼Œå¦‚åŒæ—¶é—´é›•ç¢è€Œæˆçš„æ ‘è„‚ï¼Œé—ªçƒè‘—å¤§åœ°çš„å…‰è¾‰ã€‚",
    "åè°ƒ æœ¨è´¨ 05": "çº¯ç²¹çš„é›ªæ¾é¦™æ°”ï¼Œæ´å‡€ä¸”ç¬”ç›´ï¼Œæ˜¯çµé­‚æœ€ä¸å®¹å¦¥åçš„åº•è‰²ã€‚",
    "åè°ƒ æœ¨è´¨ 06": "éºé¦™ä¸æ²‰é¦™çš„ç©ºçµç»“åˆï¼Œä»¿ä½›è·¨è¶Šæ—¶ç©ºçš„å‘¼å¸ï¼Œç¼¥ç¼ˆä¸”ç¥åœ£ã€‚",
    "åè°ƒ æœ¨è´¨ 07": "é¦™è‰ä¸æ²‰é¦™çš„ç”œè‹¦äº¤ç»‡ï¼Œå¦‚åŒæ™¨é—´ç©¿é€å±±é£çš„ç¬¬ä¸€ç¼•é˜³å…‰ï¼Œå……æ»¡å¸Œæœ›ã€‚",
    "åè°ƒ æœ¨è´¨ 08": "æª€æœ¨ä¸é»‘èƒ¡æ¤’çš„åº„ä¸¥æ„Ÿï¼Œåƒæ˜¯è¸å…¥é™è°§çš„å¯ºåº™ï¼Œæµ®èºç¬é—´æ¶ˆæ•£æ— è¸ªã€‚",
    "åè°ƒ æœ¨è´¨ 09": "è¿·è¿­é¦™ä¸æ¨Ÿæœ¨çš„æ¸…å†½ï¼Œå¦‚äº‘é›¾ç¼­ç»•çš„å±±å·…ï¼Œæ¸…å†·ä¸”è®©äººå¿ƒæ—·ç¥æ€¡ã€‚",
    "åè°ƒ æœ¨è´¨ 10": "æ²‰é¦™ä¸å¹¿è—¿é¦™çš„åšé‡æ„Ÿï¼Œæ˜¯è®°å¿†ä¸­æ— æ³•æŠ¹å»çš„æ•…ä¹¡è®°å¿†ï¼Œæ·±æƒ…ä¸”è¸å®ã€‚",
    "åè°ƒ æœ¨è´¨ 11": "æ²‰é¦™ä¸å·´è¥¿çº¢æœ¨çš„æ¿€è¡ï¼Œåœ¨ç„šé¦™çš„è¦ç»•ä¸­ï¼Œå±•ç°å‡ºä¸€ç§è¶…è„±å°˜ä¸–çš„é™è°§ã€‚",
    "åè°ƒ æœ¨è´¨ 12": "æŸæ ‘ä¸è‹¦æ©™çš„åšéŸ§ï¼Œå¦‚åŒåœ¨æœˆå…‰ä¸‹æŒºæ‹”çš„æŸæ ‘ï¼Œå®ˆæŠ¤è‘—å¤œæ™šçš„å®‰å®ã€‚",
    "åè°ƒ æœ¨è´¨ 13": "çº¯å‡€çš„æª€é¦™ï¼Œæ¸©æ¶¦å¦‚ç‰ï¼Œæ˜¯æ—¶é—´æ²‰æ·€ä¸‹æ¥çš„æœ€æ¸©æŸ”çš„åº•æ°”ã€‚"
}

# ==========================================
# æ•°æ®åº“ Bï¼šå‘½ç†ã€äººæ ¼ä¸æ¯”ä¾‹é€»è¾‘
# ==========================================
zodiac_db = {
    "ç™½ç¾Šåº§": "å‹‡æ°”ä¸æ´»åŠ›çš„å¼€æ‹“è€…ã€‚æ‹¥æœ‰ä¸€å¾€æ— å‰çš„èƒ½é‡ï¼Œæ€§æ ¼çº¯ç²¹ã€ç›´ç‡ã€‚",
    "é‡‘ç‰›åº§": "è´¨æ„Ÿç”Ÿæ´»çš„å®ˆæŠ¤è€…ã€‚æ„Ÿå®˜æ•é”ï¼Œè¿½æ±‚ç¨³å®šä¸æè‡´çš„ç¾æ„Ÿã€‚",
    "åŒå­åº§": "å¥½å¥‡çµåŠ¨çš„æ€æƒ³ä¼ æ’­è€…ã€‚æ€ç»´è·³è·ƒã€çƒ­çˆ±æ²Ÿé€šï¼Œçµé­‚ä¸­è—è‘—é£çš„è‡ªç”±ã€‚",
    "å·¨èŸ¹åº§": "ç»†è…»ç–—æ„ˆçš„æƒ…æ„Ÿæ¸©å®¤ã€‚å®ˆæŠ¤å†…åœ¨çš„å®‰å…¨æ„Ÿï¼Œæ„Ÿæ€§ä¸”å…·å¤‡æå¼ºå…±æƒ…åŠ›ã€‚",
    "ç‹®å­åº§": "è‡ªä¿¡é¢†å¯¼çš„åˆ›é€ åŠ›ä¸­å¿ƒã€‚æ‹¥æœ‰å¼ºå¤§çš„æ„å¿—ä¸æ¸©æš–çš„æ…·æ…¨ï¼Œå¦‚å¤ªé˜³èˆ¬è€€çœ¼ã€‚",
    "å¤„å¥³åº§": "è¿½æ±‚å®Œç¾çš„ç§©åºå·¥åŒ ã€‚å¿ƒæ€ç¼œå¯†ï¼Œå…·å¤‡å†·é™çš„è§‚å¯ŸåŠ›ä¸çº¯å‡€çµé­‚åº•è‰²ã€‚",
    "å¤©ç§¤åº§": "ä¼˜é›…å¹³è¡¡çš„åè°ƒè‰ºæœ¯å®¶ã€‚è¿½æ±‚å’Œè°ä¸ç¾æ„Ÿï¼Œå¤„äº‹ä»å®¹ä¸è¿«ã€‚",
    "å¤©èåº§": "ç¥ç§˜æ´å¯Ÿçš„çµé­‚æ¢æµ‹å™¨ã€‚æƒ…æ„Ÿæ·±é‚ƒã€æ„å¿—åšå®šï¼Œæ°”è´¨é«˜å†·ä¸”æå…·ç£æ€§ã€‚",
    "å°„æ‰‹åº§": "å†’é™©è‡ªç”±çš„çœŸç†è¿½å¯»è€…ã€‚çƒ­çˆ±è¿œæ–¹ä¸æ¢ç´¢ï¼Œæ‹¥æœ‰ä¸€ç§ä¸è¢«ä¸–ä¿—æ‹˜æŸçš„æ°”åœºã€‚",
    "æ‘©ç¾¯åº§": "è¸å®è´£ä»»çš„æ”€ç™»å…ˆé”‹ã€‚æ‹¥æœ‰æƒŠäººçš„è€åŠ›ä¸é‡å¿ƒï¼Œæ°”è´¨æ²‰è‘—å†·é™ã€‚",
    "æ°´ç“¶åº§": "ç‹¬ç«‹é©æ–°çš„æœªæ¥æ€æƒ³å®¶ã€‚æ€ç»´è¶…å‰ã€ç‰¹ç«‹ç‹¬è¡Œï¼Œæ•£å‘è‘—æ™ºæ…§çš„ç‹¬ç‰¹ç”µæ³¢ã€‚",
    "åŒé±¼åº§": "çµæ€§è‰ºæœ¯çš„æ¢¦æƒ³ç¼–ç»‡è€…ã€‚çµé­‚å……æ»¡è¯—æ„ï¼Œæ„Ÿæ€§ä¸”æ…ˆæ‚²ã€‚"
}

element_traits = {
    "æ°´": "ã€æ°´èƒ½é‡ï¼šçµæ€§æ™ºæ…§ã€‘å…·å¤‡æå¼ºçš„é€‚åº”åŠ›ä¸ç©¿é€åŠ›ï¼Œæ€§æ ¼ç»†è…»åŒ…å®¹ã€‚",
    "æœ¨": "ã€æœ¨èƒ½é‡ï¼šæˆé•¿ç”Ÿæœºã€‘ä»£è¡¨ç”Ÿå‘½åŠ›ï¼Œæ€§æ ¼ä»æ…ˆæ­£ç›´ï¼Œæ‹¥æœ‰è‡ªæˆ‘çªç ´çš„æ¸´æœ›ã€‚",
    "ç«": "ã€ç«èƒ½é‡ï¼šçƒ­æƒ…çƒ­çƒˆã€‘æ•£å‘æ¸©æš–ï¼Œæ€§æ ¼å¼€æœ—é‡è§†ç¤¼ä»ªï¼Œå…·å¼ºå¤§æ„ŸæŸ“åŠ›ã€‚",
    "é‡‘": "ã€é‡‘èƒ½é‡ï¼šåˆšæ¯…ç²¾å‡†ã€‘æ‹¥æœ‰å†³æ–­åŠ›ï¼Œæ€§æ ¼å†·é™æ­£ç›´ï¼Œè¿½æ±‚æ•ˆç‡ä¸æ ¸å¿ƒä»·å€¼ã€‚",
    "åœŸ": "ã€åœŸèƒ½é‡ï¼šåšé‡ç¨³å®šã€‘è±¡å¾å¤§åœ°çš„åŒ…å®¹ï¼Œæ€§æ ¼æ²‰ç¨³è¸å®ï¼Œæ˜¯å€¼å¾—ä¿¡èµ–çš„ä¾é ã€‚"
}

zodiac_animal_db = {
    "é¼ ": "æœºæ•ä¿è½ï¼Œè§‚å¯Ÿç»†å¾®ã€‚", "ç‰›": "å‹¤å¥‹ç¨³é‡ï¼Œæ„å¿—åŠ›å¼ºã€‚", "è™": "å¨çŒ›æœæ•¢ï¼Œå…·å¼€åˆ›ç²¾ç¥ã€‚",
    "å…”": "æ–‡é›…æ¸©æŸ”ï¼Œå¿ƒæ€ç¼œå¯†ã€‚", "é¾™": "å®ä¼Ÿä¸å‡¡ï¼Œé¢†è¢–é­…åŠ›ã€‚", "è›‡": "å†·é™æ²‰è‘—ï¼Œç›´è§‰çµæ•ã€‚",
    "é©¬": "å¥”æ”¾çƒ­æƒ…ï¼Œçƒ­çˆ±è‡ªç”±ã€‚", "ç¾Š": "ä½“è´´ä»æ…ˆï¼Œå…·è‰ºæœ¯æ„Ÿã€‚", "çŒ´": "èªæ˜å˜é€šï¼Œå……æ»¡åˆ›æ„ã€‚",
    "é¸¡": "è´Ÿè´£æœæ–­ï¼Œè®²æ±‚çºªå¾‹ã€‚", "ç‹—": "å¿ è¯šæ­£ä¹‰ï¼Œå€¼å¾—ä¿¡èµ–ã€‚", "çŒª": "çœŸè¯šåšé“ï¼Œæ€§æƒ…è±è¾¾ã€‚"
}

zodiac_elements = {"é¼ ": "æ°´", "çŒª": "æ°´", "è™": "æœ¨", "å…”": "æœ¨", "è›‡": "ç«", "é©¬": "ç«", "çŒ´": "é‡‘", "é¸¡": "é‡‘", "ç‰›": "åœŸ", "é¾™": "åœŸ", "ç¾Š": "åœŸ", "ç‹—": "åœŸ"}

# ==========================================
# æ•°æ®åº“ Dï¼šç”Ÿå‘½çµæ•°ä¸ªæ€§ä¸å»ºè®®
# ==========================================
life_number_db = {
    "1": {
        "trait": "å¤©ç”Ÿçš„é¢†å¯¼è€…ä¸å¼€åˆ›è€…",
        "desc": "ä½ æ‹¥æœ‰å¼ºçƒˆçš„ç‹¬ç«‹æ„è¯†ä¸å¼€åˆ›ç²¾ç¥ï¼Œä¸å–œæ¬¢è¢«çº¦æŸï¼Œæ€»æ˜¯èµ°åœ¨å‰ç«¯ã€‚ä½ çš„å†…åœ¨ç‡ƒçƒ§è‘—ä¸€è‚¡ä¸æœè¾“çš„ç«ç„°ï¼Œæ¸´æœ›è¯æ˜è‡ªå·±çš„ä»·å€¼ã€‚",
        "advice": "ä»Šå¹´å®œæŠŠæ¡æœºä¼šå±•ç°é¢†å¯¼åŠ›ï¼Œä½†åˆ‡è®°åˆšæŸ”å¹¶æµã€‚è¿‡åº¦å¼ºåŠ¿å¯èƒ½è®©è´µäººè¿œç¦»ï¼Œå­¦ä¼šå€¾å¬ä»–äººæ„è§ï¼ŒæˆåŠŸå°†æ°´åˆ°æ¸ æˆã€‚æ„Ÿæƒ…ä¸Šä¸»åŠ¨å‡ºå‡»ä¼šæœ‰å¥½ç»“æœã€‚"
    },
    "2": {
        "trait": "æ¸©æŸ”çš„åè°ƒè€…ä¸ç–—æ„ˆå¸ˆ",
        "desc": "ä½ å¤©ç”Ÿæ•æ„Ÿç»†è…»ï¼Œæ“…é•¿å¯Ÿè§‰ä»–äººæƒ…ç»ªï¼Œæ˜¯å›¢ä½“ä¸­çš„æ¶¦æ»‘å‰‚ã€‚ä½ è¿½æ±‚å’Œè°ä¸å¹³è¡¡ï¼Œä¸å–œæ¬¢å†²çªï¼Œæ€»æ˜¯é»˜é»˜ä»˜å‡ºã€‚",
        "advice": "ä»Šå¹´æ˜¯å»ºç«‹æ·±åº¦å…³ç³»çš„å¥½æ—¶æœºï¼Œä½†è¦æ³¨æ„ä¸è¦è¿‡åº¦å§”å±ˆè‡ªå·±ã€‚å­¦ä¼šè®¾ç«‹ç•Œé™ï¼Œä½ çš„æ¸©æŸ”æ‰ä¸ä¼šæˆä¸ºè´Ÿæ‹…ã€‚è´¢è¿å¹³ç¨³ï¼Œåˆä½œæŠ•èµ„ä¼˜æ–¼å•æ‰“ç‹¬æ–—ã€‚"
    },
    "3": {
        "trait": "åˆ›æ„çš„è¡¨è¾¾è€…ä¸ä¹è§‚ä¸»ä¹‰è€…",
        "desc": "ä½ å……æ»¡åˆ›é€ åŠ›ä¸æƒ³åƒåŠ›ï¼Œæ‹¥æœ‰æ„ŸæŸ“ä»–äººçš„é­…åŠ›ã€‚ä½ çƒ­çˆ±è¡¨è¾¾ï¼Œæ— è®ºæ˜¯è‰ºæœ¯ã€å†™ä½œæˆ–å£æ‰éƒ½æœ‰å¤©èµ‹ï¼Œæ˜¯å¤©ç”Ÿçš„è¡¨æ¼”è€…ã€‚",
        "advice": "ä»Šå¹´åˆ›æ„èƒ½é‡çˆ†å‘ï¼Œé€‚åˆå±•å¼€è‰ºæœ¯ç›¸å…³è®¡åˆ’æˆ–å‰¯ä¸šã€‚ä½†è¦å°å¿ƒä¸‰åˆ†é’Ÿçƒ­åº¦ï¼Œä¸“æ³¨å®Œæˆä¸€ä»¶äº‹æ¯”å¼€å§‹åä»¶äº‹æ›´é‡è¦ã€‚æ¡ƒèŠ±è¿æ—ºï¼Œä½†éœ€åˆ†è¾¨çœŸå¿ƒã€‚"
    },
    "4": {
        "trait": "ç¨³å¥çš„å»ºç­‘å¸ˆä¸å®ˆæŠ¤è€…",
        "desc": "ä½ åŠ¡å®å¯é ï¼Œæ˜¯å€¼å¾—ä¿¡èµ–çš„ä¼™ä¼´ã€‚ä½ ç›¸ä¿¡è„šè¸å®åœ°çš„åŠ›é‡ï¼Œæ„¿æ„ä»˜å‡ºåŠªåŠ›å»ºæ„ç¨³å›ºçš„åŸºç¡€ï¼Œæ˜¯å›¢é˜Ÿä¸­çš„å®šæµ·ç¥é’ˆã€‚",
        "advice": "ä»Šå¹´é€‚åˆæ‰“ç¨³æ ¹åŸºï¼Œæ— è®ºæ˜¯äº‹ä¸šã€å¥åº·æˆ–è´¢åŠ¡éƒ½å®œç¨³æ‰ç¨³æ‰“ã€‚ä¸è¦æ€¥äºæ±‚æˆï¼Œä½ çš„åšæŒç»ˆå°†å¼€èŠ±ç»“æœã€‚æ³¨æ„èº«ä½“ä¿å…»ï¼Œå°¤å…¶æ˜¯è‚©é¢ˆä¸è‚ èƒƒã€‚"
    },
    "5": {
        "trait": "è‡ªç”±çš„å†’é™©å®¶ä¸å˜é©è€…",
        "desc": "ä½ æ¸´æœ›è‡ªç”±ä¸å˜åŒ–ï¼Œè®¨åŒä¸€æˆä¸å˜çš„ç”Ÿæ´»ã€‚ä½ æ‹¥æœ‰å¼ºçƒˆçš„å¥½å¥‡å¿ƒï¼Œå–œæ¬¢æ¢ç´¢æœªçŸ¥ï¼Œæ˜¯å‹‡äºçªç ´æ¡†æ¶çš„å…ˆé”‹ã€‚",
        "advice": "ä»Šå¹´å˜åŠ¨èƒ½é‡å¼ºï¼Œå¯èƒ½æœ‰æ—…è¡Œã€æ¬è¿æˆ–è½¬æ¢è·‘é“çš„æœºä¼šã€‚æ‹¥æŠ±å˜åŒ–ä½†ä¸è¦å†²åŠ¨è¡Œäº‹ï¼Œåšå¥½è§„åˆ’å†å‡ºå‘ã€‚æ„Ÿæƒ…ä¸Šå¯èƒ½é‡åˆ°å¼‚åœ°æˆ–å¼‚å›½ç¼˜åˆ†ã€‚"
    },
    "6": {
        "trait": "çˆ±çš„ç»™äºˆè€…ä¸ç¾çš„è¿½æ±‚è€…",
        "desc": "ä½ é‡è§†å®¶åº­ä¸è´£ä»»ï¼Œæ‹¥æœ‰å¼ºçƒˆçš„çˆ±ä¸å¥‰çŒ®ç²¾ç¥ã€‚ä½ è¿½æ±‚ç¾å¥½äº‹ç‰©ï¼Œå¯¹ç”Ÿæ´»å“è´¨æœ‰è¦æ±‚ï¼Œæ˜¯å¤©ç”Ÿçš„ç…§é¡¾è€…ä¸ç¾å­¦å®¶ã€‚",
        "advice": "ä»Šå¹´å®¶åº­è¿åŠ¿é‡è¦ï¼Œå¯èƒ½æœ‰å©šå«ã€æ·»ä¸æˆ–è´­å±‹ç­‰å–œäº‹ã€‚ä½†è¦æ³¨æ„ä¸è¦è¿‡åº¦å¹²æ¶‰ä»–äººï¼Œçˆ±æ˜¯ç»™äºˆè‡ªç”±è€Œéæ§åˆ¶ã€‚è´¢è¿ä¸ç¾ç›¸å…³çš„æŠ•èµ„æœ‰åˆ©ã€‚"
    },
    "7": {
        "trait": "æ·±é‚ƒçš„æ€æƒ³å®¶ä¸çµæ€§æ¢ç´¢è€…",
        "desc": "ä½ æ‹¥æœ‰æ·±åˆ»çš„æ´å¯ŸåŠ›ä¸åˆ†æèƒ½åŠ›ï¼Œå–œæ¬¢ç‹¬å¤„æ€è€ƒäººç”Ÿå¤§å“‰é—®ã€‚ä½ è¿½æ±‚çœŸç†ä¸æ™ºæ…§ï¼Œå†…åœ¨ä¸–ç•Œä¸°å¯Œè€Œç¥ç§˜ã€‚",
        "advice": "ä»Šå¹´é€‚åˆè¿›ä¿®ã€ç ”ç©¶æˆ–çµæ€§æˆé•¿ï¼Œä½ çš„ç›´è§‰ç‰¹åˆ«å‡†ç¡®ã€‚ä½†è¦é¿å…è¿‡åº¦å°é—­è‡ªå·±ï¼Œé€‚æ—¶ä¸äººäº¤æµèƒ½å¸¦æ¥æ„æƒ³ä¸åˆ°çš„å¯å‘ã€‚å¥åº·ä¸Šæ³¨æ„ç¡çœ å“è´¨ã€‚"
    },
    "8": {
        "trait": "æƒåŠ›çš„æŒæ§è€…ä¸ç‰©è´¨çš„åˆ›é€ è€…",
        "desc": "ä½ æ‹¥æœ‰å¼ºå¤§çš„æ‰§è¡ŒåŠ›ä¸å•†ä¸šå¤´è„‘ï¼Œå¯¹æˆåŠŸæœ‰å¼ºçƒˆæ¸´æœ›ã€‚ä½ æ‡‚å¾—è¿ç”¨èµ„æºï¼Œæ˜¯å¤©ç”Ÿçš„ä¼ä¸šå®¶ä¸é¢†è¢–ï¼Œæ³¨å®šä¸è´¢å¯Œæœ‰ç¼˜ã€‚",
        "advice": "ä»Šå¹´äº‹ä¸šè¿å¼ºåŠ²ï¼Œæœ‰å‡è¿åŠ è–ªæˆ–åˆ›ä¸šè‰¯æœºã€‚ä½†æƒåŠ›è¶Šå¤§è´£ä»»è¶Šå¤§ï¼Œæ³¨æ„ä¸è¦å¿½ç•¥å®¶äººæ„Ÿå—ã€‚è´¢è¿äº¨é€šä½†åˆ‡å¿Œè´ªå©ªï¼Œè§å¥½å°±æ”¶æ˜¯æ™ºæ…§ã€‚"
    },
    "9": {
        "trait": "åšçˆ±çš„ç†æƒ³ä¸»ä¹‰è€…ä¸ç–—æ„ˆè€…",
        "desc": "ä½ æ‹¥æœ‰å®½å¹¿çš„èƒ¸æ€€ä¸æ‚²å¤©æ‚¯äººçš„æƒ…æ€€ï¼Œæ¸´æœ›è®©ä¸–ç•Œå˜å¾—æ›´å¥½ã€‚ä½ æ˜¯å¤©ç”Ÿçš„åŠ©äººè€…ï¼Œç»å¸¸å¸å¼•éœ€è¦å¸®åŠ©çš„äººé è¿‘ã€‚",
        "advice": "ä»Šå¹´æ˜¯å®Œæˆä¸æ”¾ä¸‹çš„ä¸€å¹´ï¼Œæ—§çš„ç¯‡ç« å³å°†ç»“æŸï¼Œæ–°çš„å³å°†å¼€å§‹ã€‚å­¦ä¼šé‡Šæ€€è¿‡å»çš„é—æ†¾ï¼Œä½ çš„å–„è‰¯ç»ˆå°†å¾—åˆ°å®‡å®™çš„å›æŠ¥ã€‚å…¬ç›Šæ´»åŠ¨ä¼šå¸¦æ¥å¥½è¿ã€‚"
    }
}

# ==========================================
# æ•°æ®åº“ Eï¼š2026 é©¬å¹´å¹¸è¿è‰²
# ==========================================
horse_year_lucky_colors = {
    # ç”Ÿè‚–å¹¸è¿è‰² (2026 é©¬å¹´)
    "zodiac": {
        "é¼ ": {"colors": ["å®è“è‰²", "é“¶ç™½è‰²"], "avoid": "çº¢è‰²", "reason": "é¼ é©¬ç›¸å†²ï¼Œå®œç”¨æ°´è‰²åŒ–è§£ï¼Œè“è‰²å¸¦æ¥å†·é™ä¸æ™ºæ…§ã€‚"},
        "ç‰›": {"colors": ["å’–å•¡è‰²", "ç±³ç™½è‰²"], "avoid": "ç»¿è‰²", "reason": "ç‰›ä¸é©¬æ— åˆ‘å†²ï¼ŒåœŸè‰²ç³»ç¨³å›ºæ ¹åŸºï¼Œå¸¦æ¥è¸å®èƒ½é‡ã€‚"},
        "è™": {"colors": ["ç¿ ç»¿è‰²", "æ©™çº¢è‰²"], "avoid": "ç™½è‰²", "reason": "è™é©¬ä¸‰åˆï¼Œç«æœ¨ç›¸ç”Ÿï¼Œç»¿è‰²ä¸æ©™è‰²åŠ©æ—ºè´µäººè¿ã€‚"},
        "å…”": {"colors": ["æµ…ç²‰è‰²", "æ·¡ç´«è‰²"], "avoid": "æ·±è“è‰²", "reason": "å…”ä¸é©¬æ— å¤§ç¢ï¼ŒæŸ”å’Œè‰²è°ƒæå‡äººç¼˜ä¸æ¡ƒèŠ±è¿ã€‚"},
        "é¾™": {"colors": ["é‡‘é»„è‰²", "é…’çº¢è‰²"], "avoid": "é»‘è‰²", "reason": "é¾™é©¬ç²¾ç¥ç›¸åŠ©ï¼Œé‡‘è‰²æ‹›è´¢ï¼Œé…’çº¢å¢æ·»å°Šè´µæ°”åœºã€‚"},
        "è›‡": {"colors": ["æ£çº¢è‰²", "ç´«çº¢è‰²"], "avoid": "ç™½è‰²", "reason": "è›‡é©¬å…­åˆå¤§å‰ï¼Œçº¢ç´«è‰²ç³»å¼ºåŒ–è¿™ä»½è´µäººç¼˜åˆ†ã€‚"},
        "é©¬": {"colors": ["è‰ç»¿è‰²", "ç²‰çº¢è‰²"], "avoid": "è“è‰²", "reason": "æœ¬å‘½å¹´å®œä½è°ƒï¼Œç»¿è‰²å¸¦æ¥ç”Ÿæœºï¼Œç²‰è‰²åŒ–è§£ç…æ°”ã€‚"},
        "ç¾Š": {"colors": ["æ©˜æ©™è‰²", "é¹…é»„è‰²"], "avoid": "ç°è‰²", "reason": "ç¾Šé©¬ä¸‰åˆï¼Œæš–è‰²è°ƒå‚¬æ—ºè¿™ä»½å¥½è¿ï¼Œå¸¦æ¥å–œæ‚¦èƒ½é‡ã€‚"},
        "çŒ´": {"colors": ["ç™½è‰²", "é“¶ç°è‰²"], "avoid": "çº¢è‰²", "reason": "çŒ´ä¸é©¬ç›¸åˆ‘ï¼Œé‡‘è‰²ç³»åŒ–è§£å†²çªï¼Œå¸¦æ¥å†·é™æ€è€ƒã€‚"},
        "é¸¡": {"colors": ["é‡‘è‰²", "ç±³é»„è‰²"], "avoid": "çº¢è‰²", "reason": "é¸¡é©¬æ— ç¢ï¼Œé‡‘è‰²æ‹›è´¢çº³ç¦ï¼Œç±³é»„å¢æ·»ç¨³é‡æ°”è´¨ã€‚"},
        "ç‹—": {"colors": ["å¢¨ç»¿è‰²", "æ©™è‰²"], "avoid": "è“è‰²", "reason": "ç‹—é©¬ä¸‰åˆï¼Œç»¿æ©™è‰²ç³»å¼ºåŒ–åˆä½œè¿ä¸äº‹ä¸šè¿ã€‚"},
        "çŒª": {"colors": ["æ·±è“è‰²", "é»‘è‰²"], "avoid": "é»„è‰²", "reason": "çŒªä¸é©¬æ— å¤§å†²ï¼Œæ°´è‰²ç³»å¸¦æ¥æ™ºæ…§ï¼Œé»‘è‰²ç¨³å®šæƒ…ç»ªã€‚"}
    },
    # çµæ•°å¹¸è¿è‰² (2026 é©¬å¹´)
    "life_number": {
        "1": {"colors": ["æ­£çº¢è‰²", "é‡‘è‰²"], "reason": "é¢†å¯¼è€…èƒ½é‡éœ€è¦æ­£çº¢è‰²çš„çƒ­æƒ…ä¸é‡‘è‰²çš„æƒå¨åŠ æŒã€‚"},
        "2": {"colors": ["ç²‰çº¢è‰²", "é“¶ç™½è‰²"], "reason": "åè°ƒè€…éœ€è¦æŸ”å’Œè‰²è°ƒï¼Œç²‰é“¶å¸¦æ¥å’Œè°ä¸æ¸©æŸ”åŠ›é‡ã€‚"},
        "3": {"colors": ["æ©™è‰²", "é»„è‰²"], "reason": "åˆ›æ„èƒ½é‡ä¸æš–è‰²è°ƒå…±æŒ¯ï¼Œæ©™é»„è‰²æ¿€å‘çµæ„Ÿä¸è¡¨è¾¾åŠ›ã€‚"},
        "4": {"colors": ["æ£•è‰²", "æ·±ç»¿è‰²"], "reason": "ç¨³å¥èƒ½é‡éœ€è¦å¤§åœ°è‰²ç³»ï¼Œå¸¦æ¥æ‰æ ¹ä¸å®‰å…¨æ„Ÿã€‚"},
        "5": {"colors": ["å¤©è“è‰²", "äº®ç»¿è‰²"], "reason": "è‡ªç”±èƒ½é‡å–œçˆ±æ¸…æ–°è‰²è°ƒï¼Œè“ç»¿è‰²å¸¦æ¥å†’é™©ä¸çªç ´ã€‚"},
        "6": {"colors": ["ç²‰ç´«è‰²", "ç«ç‘°é‡‘"], "reason": "çˆ±çš„èƒ½é‡ä¸æµªæ¼«è‰²ç³»å…±æŒ¯ï¼Œå¢æ·»ç¾æ„Ÿä¸å®¶åº­å’Œè°ã€‚"},
        "7": {"colors": ["é›è“è‰²", "ç´«è‰²"], "reason": "çµæ€§èƒ½é‡éœ€è¦æ·±é‚ƒè‰²è°ƒï¼Œç´«è“è‰²æå‡ç›´è§‰ä¸æ™ºæ…§ã€‚"},
        "8": {"colors": ["é»‘è‰²", "é‡‘è‰²"], "reason": "æƒåŠ›èƒ½é‡ä¸å°Šè´µè‰²ç³»å…±æŒ¯ï¼Œé»‘é‡‘ç»„åˆæ‹›è´¢åˆç¨³é‡ã€‚"},
        "9": {"colors": ["ç™½è‰²", "æµ…ç´«è‰²"], "reason": "åšçˆ±èƒ½é‡éœ€è¦çº¯å‡€è‰²è°ƒï¼Œç™½ç´«å¸¦æ¥ç–—æ„ˆä¸æ…ˆæ‚²åŠ›é‡ã€‚"}
    }
}

# ==========================================
# æ•°æ®åº“ Fï¼šå…«å­—äº”è¡Œè®¡ç®—
# ==========================================
# å¤©å¹²
HEAVENLY_STEMS = ["ç”²", "ä¹™", "ä¸™", "ä¸", "æˆŠ", "å·±", "åºš", "è¾›", "å£¬", "ç™¸"]
# åœ°æ”¯
EARTHLY_BRANCHES = ["å­", "ä¸‘", "å¯…", "å¯", "è¾°", "å·³", "åˆ", "æœª", "ç”³", "é…‰", "æˆŒ", "äº¥"]
# å¤©å¹²äº”è¡Œ
STEM_ELEMENTS = {"ç”²": "æœ¨", "ä¹™": "æœ¨", "ä¸™": "ç«", "ä¸": "ç«", "æˆŠ": "åœŸ", "å·±": "åœŸ", "åºš": "é‡‘", "è¾›": "é‡‘", "å£¬": "æ°´", "ç™¸": "æ°´"}
# åœ°æ”¯äº”è¡Œ
BRANCH_ELEMENTS = {"å­": "æ°´", "ä¸‘": "åœŸ", "å¯…": "æœ¨", "å¯": "æœ¨", "è¾°": "åœŸ", "å·³": "ç«", "åˆ": "ç«", "æœª": "åœŸ", "ç”³": "é‡‘", "é…‰": "é‡‘", "æˆŒ": "åœŸ", "äº¥": "æ°´"}
# æ—¶è¾°å¯¹åº”
HOUR_BRANCHES = {
    "å­æ—¶ (23:00-01:00)": "å­", "ä¸‘æ—¶ (01:00-03:00)": "ä¸‘", "å¯…æ—¶ (03:00-05:00)": "å¯…",
    "å¯æ—¶ (05:00-07:00)": "å¯", "è¾°æ—¶ (07:00-09:00)": "è¾°", "å·³æ—¶ (09:00-11:00)": "å·³",
    "åˆæ—¶ (11:00-13:00)": "åˆ", "æœªæ—¶ (13:00-15:00)": "æœª", "ç”³æ—¶ (15:00-17:00)": "ç”³",
    "é…‰æ—¶ (17:00-19:00)": "é…‰", "æˆŒæ—¶ (19:00-21:00)": "æˆŒ", "äº¥æ—¶ (21:00-23:00)": "äº¥"
}

# äº”è¡Œè¡¥å……å»ºè®®
ELEMENT_ADVICE = {
    "é‡‘": {"desc": "é‡‘ä¸»ä¹‰ï¼Œä»£è¡¨å†³æ–­ä¸æ­£ä¹‰æ„Ÿ", "è¡¥": "å¤šç©¿ç™½è‰²ã€é‡‘è‰²è¡£ç‰©ï¼Œé…æˆ´é‡‘å±é¥°å“ï¼Œå¤šå¾€è¥¿æ–¹å‘å±•ã€‚", "æ°´æ™¶": "ç™½æ°´æ™¶ã€é’›æ™¶ã€é‡‘å‘æ™¶"},
    "æœ¨": {"desc": "æœ¨ä¸»ä»ï¼Œä»£è¡¨æˆé•¿ä¸æ…ˆæ‚²å¿ƒ", "è¡¥": "å¤šç©¿ç»¿è‰²è¡£ç‰©ï¼Œå¤šæ¥è§¦æ¤ç‰©ä¸å¤§è‡ªç„¶ï¼Œå¤šå¾€ä¸œæ–¹å‘å±•ã€‚", "æ°´æ™¶": "ç»¿å¹½çµã€ç»¿å‘æ™¶ã€ä¸œè±ç‰"},
    "æ°´": {"desc": "æ°´ä¸»æ™ºï¼Œä»£è¡¨æ™ºæ…§ä¸çµæ´»æ€§", "è¡¥": "å¤šç©¿é»‘è‰²ã€è“è‰²è¡£ç‰©ï¼Œå¤šäº²è¿‘æ°´è¾¹ï¼Œå¤šå¾€åŒ—æ–¹å‘å±•ã€‚", "æ°´æ™¶": "æµ·è“å®ã€é»‘æ›œçŸ³ã€è“çº¹ç›ç‘™"},
    "ç«": {"desc": "ç«ä¸»ç¤¼ï¼Œä»£è¡¨çƒ­æƒ…ä¸æ„ŸæŸ“åŠ›", "è¡¥": "å¤šç©¿çº¢è‰²ã€ç´«è‰²è¡£ç‰©ï¼Œå¤šæ™’å¤ªé˜³ï¼Œå¤šå¾€å—æ–¹å‘å±•ã€‚", "æ°´æ™¶": "çº¢ç›ç‘™ã€ç´«æ°´æ™¶ã€çŸ³æ¦´çŸ³"},
    "åœŸ": {"desc": "åœŸä¸»ä¿¡ï¼Œä»£è¡¨ç¨³é‡ä¸åŒ…å®¹åŠ›", "è¡¥": "å¤šç©¿é»„è‰²ã€æ£•è‰²è¡£ç‰©ï¼Œå¤šæ¥è§¦å¤§åœ°ï¼Œå±…ä¸­å‘å±•æœ€ä½³ã€‚", "æ°´æ™¶": "é»„æ°´æ™¶ã€è™çœ¼çŸ³ã€èŒ¶æ™¶"}
}

def get_year_pillar(year):
    """è®¡ç®—å¹´æŸ±"""
    stem_index = (year - 4) % 10
    branch_index = (year - 4) % 12
    return HEAVENLY_STEMS[stem_index], EARTHLY_BRANCHES[branch_index]

def get_month_pillar(year, month):
    """è®¡ç®—æœˆæŸ±ï¼ˆç®€åŒ–ç‰ˆï¼‰"""
    # æœˆæŸ±çš„å¤©å¹²éœ€è¦æ ¹æ®å¹´å¹²æ¥æ¨ç®—
    year_stem_index = (year - 4) % 10
    # æœˆæ”¯å›ºå®šï¼šå¯…æœˆ=1æœˆ, å¯æœˆ=2æœˆ...
    month_branch_index = (month + 1) % 12
    # æœˆå¹²è®¡ç®—å…¬å¼
    month_stem_index = (year_stem_index * 2 + month) % 10
    return HEAVENLY_STEMS[month_stem_index], EARTHLY_BRANCHES[month_branch_index]

def get_day_pillar(year, month, day):
    """è®¡ç®—æ—¥æŸ±ï¼ˆä½¿ç”¨ç®€åŒ–å…¬å¼ï¼‰"""
    # ç®€åŒ–çš„æ—¥æŸ±è®¡ç®—
    base = date(1900, 1, 1)
    target = date(year, month, day)
    days = (target - base).days
    stem_index = (days + 10) % 10
    branch_index = days % 12
    return HEAVENLY_STEMS[stem_index], EARTHLY_BRANCHES[branch_index]

def get_hour_pillar(day_stem, hour_branch):
    """è®¡ç®—æ—¶æŸ±"""
    day_stem_index = HEAVENLY_STEMS.index(day_stem)
    hour_branch_index = EARTHLY_BRANCHES.index(hour_branch)
    # æ—¶å¹²è®¡ç®—å…¬å¼
    hour_stem_index = (day_stem_index * 2 + hour_branch_index) % 10
    return HEAVENLY_STEMS[hour_stem_index], hour_branch

def calculate_five_elements(birthday, birth_hour=None):
    """è®¡ç®—å…«å­—äº”è¡Œ"""
    year, month, day = birthday.year, birthday.month, birthday.day

    # è®¡ç®—å››æŸ±
    year_stem, year_branch = get_year_pillar(year)
    month_stem, month_branch = get_month_pillar(year, month)
    day_stem, day_branch = get_day_pillar(year, month, day)

    pillars = [
        (year_stem, year_branch, "å¹´æŸ±"),
        (month_stem, month_branch, "æœˆæŸ±"),
        (day_stem, day_branch, "æ—¥æŸ±")
    ]

    if birth_hour:
        hour_stem, hour_branch = get_hour_pillar(day_stem, birth_hour)
        pillars.append((hour_stem, hour_branch, "æ—¶æŸ±"))

    # ç»Ÿè®¡äº”è¡Œ
    element_count = {"é‡‘": 0, "æœ¨": 0, "æ°´": 0, "ç«": 0, "åœŸ": 0}
    for stem, branch, _ in pillars:
        element_count[STEM_ELEMENTS[stem]] += 1
        element_count[BRANCH_ELEMENTS[branch]] += 1

    # æ‰¾å‡ºç¼ºå°‘çš„äº”è¡Œ
    missing = [e for e, c in element_count.items() if c == 0]
    weak = [e for e, c in element_count.items() if c == 1]
    strong = [e for e, c in element_count.items() if c >= 3]

    return {
        "pillars": pillars,
        "counts": element_count,
        "missing": missing,
        "weak": weak,
        "strong": strong,
        "day_master": STEM_ELEMENTS[day_stem]  # æ—¥ä¸»äº”è¡Œ
    }

mbti_db = {
    "INTJ (å»ºç­‘å¸ˆ)": {
        "top": ["å‰è°ƒ èŠ³é¦™ 01", "å‰è°ƒ æŸ‘è‹” 01", "å‰è°ƒ èŠ³é¦™ 05"],
        "mid": ["ä¸­è°ƒ èŠ±é¦™ 01", "ä¸­è°ƒ èŠ±é¦™ 02", "ä¸­è°ƒ èŠ±é¦™ 19"],
        "base": ["åè°ƒ æœ¨è´¨ 01", "åè°ƒ æœ¨è´¨ 08", "åè°ƒ æœ¨è´¨ 05"]
    },
    "INFP (è°ƒè§£è€…)": {
        "top": ["å‰è°ƒ èŠ³é¦™ 03", "å‰è°ƒ èŠ³é¦™ 02", "å‰è°ƒ æŸ‘æ©˜ 01"],
        "mid": ["ä¸­è°ƒ èŠ±é¦™ 19", "ä¸­è°ƒ èŠ±é¦™ 03", "ä¸­è°ƒ æœé¦™ 01"],
        "base": ["åè°ƒ æœ¨è´¨ 13", "åè°ƒ æœ¨è´¨ 02", "åè°ƒ ä¸œæ–¹ 02"]
    },
    "INFJ (æå€¡è€…)": {
        "top": ["å‰è°ƒ èŠ³é¦™ 09", "å‰è°ƒ æŸ‘è‹” 04", "å‰è°ƒ èŠ³é¦™ 05"],
        "mid": ["ä¸­è°ƒ èŠ±é¦™ 04", "ä¸­è°ƒ èŠ±é¦™ 06", "ä¸­è°ƒ èŠ±é¦™ 14"],
        "base": ["åè°ƒ æœ¨è´¨ 11", "åè°ƒ æœ¨è´¨ 06", "åè°ƒ ä¸œæ–¹ 02"]
    },
    "ENFP (ç«é€‰è€…)": {
        "top": ["å‰è°ƒ æŸ‘æ©˜ 04", "å‰è°ƒ æŸ‘æ©˜ 02", "å‰è°ƒ èŠ³é¦™ 08"],
        "mid": ["ä¸­è°ƒ æœé¦™ 03", "ä¸­è°ƒ æœé¦™ 04", "ä¸­è°ƒ èŠ±é¦™ 07"],
        "base": ["åè°ƒ ä¸œæ–¹ 06", "åè°ƒ ä¸œæ–¹ 11", "åè°ƒ æœ¨è´¨ 13"]
    },
    "ENTJ (æŒ‡æŒ¥å®˜)": {
        "top": ["å‰è°ƒ èŠ³é¦™ 04", "å‰è°ƒ æŸ‘è‹” 01", "å‰è°ƒ æŸ‘æ©˜ 03"],
        "mid": ["ä¸­è°ƒ èŠ±é¦™ 11", "ä¸­è°ƒ æœé¦™ 05", "ä¸­è°ƒ æœé¦™ 01"],
        "base": ["åè°ƒ ä¸œæ–¹ 09", "åè°ƒ æœ¨è´¨ 08", "åè°ƒ ä¸œæ–¹ 03"]
    },
    "ENTP (è¾©è®ºå®¶)": {
        "top": ["å‰è°ƒ æŸ‘æ©˜ 04", "å‰è°ƒ èŠ³é¦™ 07", "å‰è°ƒ æŸ‘è‹” 03"],
        "mid": ["ä¸­è°ƒ æœé¦™ 07", "ä¸­è°ƒ æœé¦™ 08", "ä¸­è°ƒ èŠ±é¦™ 17"],
        "base": ["åè°ƒ ä¸œæ–¹ 03", "åè°ƒ ä¸œæ–¹ 09", "åè°ƒ æœ¨è´¨ 11"]
    },
    "ENFJ (ä¸»äººå…¬)": {
        "top": ["å‰è°ƒ æŸ‘æ©˜ 07", "å‰è°ƒ èŠ³é¦™ 09", "å‰è°ƒ æŸ‘æ©˜ 05"],
        "mid": ["ä¸­è°ƒ èŠ±é¦™ 05", "ä¸­è°ƒ èŠ±é¦™ 09", "ä¸­è°ƒ æœé¦™ 06"],
        "base": ["åè°ƒ æœ¨è´¨ 13", "åè°ƒ ä¸œæ–¹ 08", "åè°ƒ æœ¨è´¨ 12"]
    },
    "ISTJ (ç‰©æµå¸ˆ)": {
        "top": ["å‰è°ƒ èŠ³é¦™ 06", "å‰è°ƒ æŸ‘è‹” 02", "å‰è°ƒ èŠ³é¦™ 08"],
        "mid": ["ä¸­è°ƒ èŠ±é¦™ 01", "ä¸­è°ƒ èŠ±é¦™ 08", "ä¸­è°ƒ æœé¦™ 12"],
        "base": ["åè°ƒ æœ¨è´¨ 05", "åè°ƒ æœ¨è´¨ 03", "åè°ƒ æœ¨è´¨ 10"]
    },
    "ISFJ (å®ˆå«è€…)": {
        "top": ["å‰è°ƒ æŸ‘æ©˜ 07", "å‰è°ƒ èŠ³é¦™ 02", "å‰è°ƒ æŸ‘æ©˜ 01"],
        "mid": ["ä¸­è°ƒ èŠ±é¦™ 09", "ä¸­è°ƒ èŠ±é¦™ 12", "ä¸­è°ƒ èŠ±é¦™ 18"],
        "base": ["åè°ƒ æœ¨è´¨ 02", "åè°ƒ ä¸œæ–¹ 08", "åè°ƒ æœ¨è´¨ 01"]
    },
    "ESTJ (æ€»ç»ç†)": {
        "top": ["å‰è°ƒ èŠ³é¦™ 02", "å‰è°ƒ æŸ‘æ©˜ 05", "å‰è°ƒ èŠ³é¦™ 08"],
        "mid": ["ä¸­è°ƒ èŠ±é¦™ 01", "ä¸­è°ƒ æœé¦™ 11", "ä¸­è°ƒ æœé¦™ 12"],
        "base": ["åè°ƒ æœ¨è´¨ 03", "åè°ƒ æœ¨è´¨ 08", "åè°ƒ æœ¨è´¨ 10"]
    },
    "ESFJ (æ‰§æ”¿å®˜)": {
        "top": ["å‰è°ƒ æœé¦™ 03", "å‰è°ƒ æŸ‘æ©˜ 02", "å‰è°ƒ æŸ‘æ©˜ 01"],
        "mid": ["ä¸­è°ƒ èŠ±é¦™ 14", "ä¸­è°ƒ èŠ±é¦™ 16", "ä¸­è°ƒ æœé¦™ 10"],
        "base": ["åè°ƒ ä¸œæ–¹ 06", "åè°ƒ æœ¨è´¨ 13", "åè°ƒ ä¸œæ–¹ 11"]
    },
    "ISTP (é‰´èµå®¶)": {
        "top": ["å‰è°ƒ èŠ³é¦™ 07", "å‰è°ƒ æŸ‘è‹” 03", "å‰è°ƒ èŠ³é¦™ 06"],
        "mid": ["ä¸­è°ƒ æœé¦™ 09", "ä¸­è°ƒ èŠ±é¦™ 08", "ä¸­è°ƒ æœé¦™ 14"],
        "base": ["åè°ƒ æœ¨è´¨ 06", "åè°ƒ æœ¨è´¨ 12", "åè°ƒ ä¸œæ–¹ 02"]
    },
    "ISFP (æ¢é™©å®¶)": {
        "top": ["å‰è°ƒ æŸ‘æ©˜ 03", "å‰è°ƒ èŠ³é¦™ 03", "å‰è°ƒ æŸ‘æ©˜ 06"],
        "mid": ["ä¸­è°ƒ èŠ±é¦™ 07", "ä¸­è°ƒ æœé¦™ 02", "ä¸­è°ƒ èŠ±é¦™ 03"],
        "base": ["åè°ƒ æœ¨è´¨ 07", "åè°ƒ ä¸œæ–¹ 05", "åè°ƒ æœ¨è´¨ 04"]
    },
    "ESTP (ä¼ä¸šå®¶)": {
        "top": ["å‰è°ƒ æŸ‘æ©˜ 04", "å‰è°ƒ æŸ‘è‹” 01", "å‰è°ƒ èŠ³é¦™ 04"],
        "mid": ["ä¸­è°ƒ æœé¦™ 07", "ä¸­è°ƒ æœé¦™ 08", "ä¸­è°ƒ æœé¦™ 13"],
        "base": ["åè°ƒ ä¸œæ–¹ 07", "åè°ƒ ä¸œæ–¹ 09", "åè°ƒ æœ¨è´¨ 12"]
    },
    "ESFP (è¡¨æ¼”è€…)": {
        "top": ["å‰è°ƒ æŸ‘æ©˜ 02", "å‰è°ƒ æŸ‘æ©˜ 04", "å‰è°ƒ æœé¦™ 04"],
        "mid": ["ä¸­è°ƒ èŠ±é¦™ 10", "ä¸­è°ƒ èŠ±é¦™ 13", "ä¸­è°ƒ æœé¦™ 15"],
        "base": ["åè°ƒ ä¸œæ–¹ 11", "åè°ƒ ä¸œæ–¹ 06", "åè°ƒ ä¸œæ–¹ 01"]
    },
    "INTP (é€»è¾‘å­¦å®¶)": {
        "top": ["å‰è°ƒ èŠ³é¦™ 01", "å‰è°ƒ èŠ³é¦™ 09", "å‰è°ƒ æŸ‘è‹” 04"],
        "mid": ["ä¸­è°ƒ æœé¦™ 14", "ä¸­è°ƒ èŠ±é¦™ 06", "ä¸­è°ƒ æœé¦™ 09"],
        "base": ["åè°ƒ æœ¨è´¨ 06", "åè°ƒ æœ¨è´¨ 11", "åè°ƒ ä¸œæ–¹ 02"]
    }
}

# MBTI ä¸ªæ€§å…³é”®è¯ï¼ˆç”¨äºé¦™å‘³åŒ¹é…è¯´æ˜ï¼‰
mbti_personality = {
    "INTJ (å»ºç­‘å¸ˆ)": "æ·±æ€ç†Ÿè™‘ã€è¿½æ±‚å“è¶Š",
    "INFP (è°ƒè§£è€…)": "æµªæ¼«ç†æƒ³ã€æ¸©æŸ”æ•æ„Ÿ",
    "INFJ (æå€¡è€…)": "ç›´è§‰æ•é”ã€æ·±æƒ…å†…æ•›",
    "ENFP (ç«é€‰è€…)": "çƒ­æƒ…å¼€æœ—ã€å……æ»¡æ´»åŠ›",
    "ENTJ (æŒ‡æŒ¥å®˜)": "è‡ªä¿¡æœæ–­ã€é¢†å¯¼é­…åŠ›",
    "ENTP (è¾©è®ºå®¶)": "æœºæ™ºçµæ´»ã€å¤§èƒ†åˆ›æ–°",
    "ENFJ (ä¸»äººå…¬)": "æ¸©æš–çƒ­å¿ƒã€æ„ŸæŸ“åŠ›å¼º",
    "ISTJ (ç‰©æµå¸ˆ)": "ç¨³é‡åŠ¡å®ã€ä¸¥è°¨å¯é ",
    "ISFJ (å®ˆå«è€…)": "æ¸©æŸ”ä½“è´´ã€ç»†å¿ƒå‘µæŠ¤",
    "ESTJ (æ€»ç»ç†)": "é«˜æ•ˆæœæ–­ã€åŠ¡å®è´Ÿè´£",
    "ESFJ (æ‰§æ”¿å®˜)": "çƒ­å¿ƒå‹å–„ã€ä¹äºåŠ©äºº",
    "ISTP (é‰´èµå®¶)": "å†·é™ç†æ€§ã€ç‹¬ç«‹æ²‰è‘—",
    "ISFP (æ¢é™©å®¶)": "è‰ºæœ¯æ„Ÿæ€§ã€è‡ªç”±çœŸå®",
    "ESTP (ä¼ä¸šå®¶)": "å¤§èƒ†æœæ•¢ã€å‹‡äºå†’é™©",
    "ESFP (è¡¨æ¼”è€…)": "æ´»æ³¼å¼€æœ—ã€çƒ­çˆ±ç”Ÿæ´»",
    "INTP (é€»è¾‘å­¦å®¶)": "ç†æ€§æ·±é‚ƒã€å¥½å¥‡æ¢ç´¢"
}

zodiac_scents = {
    "ç™½ç¾Šåº§": {"top": "å‰è°ƒ æŸ‘æ©˜ 04", "reason": "è‘¡è„æŸšçš„çˆ†å‘åŠ›å¯¹åº”å¼€æ‹“è€…ä¸ç†„çš„å‹‡æ°”èƒ½é‡ã€‚"},
    "é‡‘ç‰›åº§": {"top": "å‰è°ƒ èŠ³é¦™ 05", "reason": "æ €å­èŠ±çš„ç»†è…»çº¯å‡€ï¼Œå‘¼åº”æ‚¨å¯¹æ„Ÿå®˜å“è´¨ä¸è´¨æ„Ÿçš„è¿½æ±‚ã€‚"},
    "åŒå­åº§": {"top": "å‰è°ƒ èŠ³é¦™ 02", "reason": "ç½—å‹’ä¸ç™¾é‡Œé¦™çš„çµåŠ¨ï¼Œè¯ é‡Šæ‚¨è·³è·ƒçš„å¥½å¥‡å¿ƒä¸æ€è€ƒé€Ÿåº¦ã€‚"},
    "å·¨èŸ¹åº§": {"top": "å‰è°ƒ èŠ³é¦™ 01", "reason": "æ¸…å†·ä¹Œé¾™åçš„æ¸©æ¶¦ä½™éŸµï¼Œè¥é€ å‡ºå¦‚å®¶ä¸€èˆ¬çš„å½’å±ä¸å®‰å…¨æ„Ÿã€‚"},
    "ç‹®å­åº§": {"top": "å‰è°ƒ èŠ³é¦™ 04", "reason": "é©¬éƒå…°çš„è‚†æ„å¥”æ”¾ï¼Œå±•ç°æ‚¨å¤©ç”Ÿçš„é¢†å¯¼è€…é­…åŠ›ä¸åˆ›é€ åŠ›æ°”åœºã€‚"},
    "å¤„å¥³åº§": {"top": "å‰è°ƒ èŠ³é¦™ 06", "reason": "èŒ¶æ ‘çš„æ¸…å†½ä¸çº¯å‡€ï¼Œå‘¼åº”æ‚¨å¯¹äº‹ç‰©ç»†èŠ‚ä¸å®Œç¾çš„æè‡´åšæŒã€‚"},
    "å¤©ç§¤åº§": {"top": "å‰è°ƒ èŠ³é¦™ 09", "reason": "ç»¿èŒ¶çš„ä¼˜é›…æ¸…èŠ¬ï¼ŒåŠ©æ‚¨è¾¾æˆå†…åœ¨çµé­‚ä¸å¤–åœ¨ç¯å¢ƒçš„æè‡´å¹³è¡¡ã€‚"},
    "å¤©èåº§": {"top": "å‰è°ƒ æŸ‘è‹” 01", "reason": "æ— èŠ±æœæœ¨çš„æ·±é‚ƒæ„Ÿï¼Œå¯¹åº”æ‚¨ç¥ç§˜çš„ç›´è§‰ä¸å¼ºå¤§çš„çµé­‚è½¬åŒ–åŠ›ã€‚"},
    "å°„æ‰‹åº§": {"top": "å‰è°ƒ èŠ³é¦™ 08", "reason": "é©¬é­è‰çš„æ¸…çˆ½è·³è·ƒï¼Œå¸¦é¢†çµé­‚è¿½å¯»è¿œæ–¹ä¸è¢«æŸç¼šçš„ç»å¯¹è‡ªç”±ã€‚"},
    "æ‘©ç¾¯åº§": {"top": "å‰è°ƒ èŠ³é¦™ 01", "reason": "æ²ˆç¨³ç»“æ„çš„å°è±†è”»èŒ¶é¦™ï¼Œå±•ç°æ‚¨è¸å®å‰è¡Œã€å€¼å¾—ä¿¡èµ–çš„è´£ä»»æ„Ÿã€‚"},
    "æ°´ç“¶åº§": {"top": "å‰è°ƒ èŠ³é¦™ 07", "reason": "æè‡´æ¸…å‡‰çš„è–„è·ï¼Œè‡´æ•¬æ‚¨ç‰¹ç«‹ç‹¬è¡Œã€é©æ–°æœªæ¥çš„äººé“ä¸»ä¹‰çµé­‚ã€‚"},
    "åŒé±¼åº§": {"top": "å‰è°ƒ èŠ³é¦™ 03", "reason": "å«ç¾è‰çš„æ¢¦å¹»ç²‰æ„Ÿï¼Œè®©æ‚¨çš„è‰ºæœ¯çµé­‚åœ¨æ¢¦å¢ƒä¸ç°å®é—´æµªæ¼«å‘¼å¸ã€‚"}
}

element_scents = {
    "æ°´": {"base": "åè°ƒ ä¸œæ–¹ 02"}, "æœ¨": {"base": "åè°ƒ æœ¨è´¨ 02"},
    "ç«": {"base": "åè°ƒ ä¸œæ–¹ 06"}, "é‡‘": {"base": "åè°ƒ æœ¨è´¨ 05"}, "åœŸ": {"base": "åè°ƒ æœ¨è´¨ 08"}
}

model_logic = {
    "é»„é‡‘å¹³è¡¡å‹ (20:35:45)": {"ratios": [0.20, 0.35, 0.45], "desc": "æœ€ç¨³å®šçš„ç»“æ„ï¼Œé¦™æ°”è¡”æ¥å¹³æ»‘ã€‚"},
    "æ¸…æ–°çˆ†å‘å‹ (40:35:25)": {"ratios": [0.40, 0.35, 0.25], "desc": "å¼ºåŒ–å‰è°ƒçˆ†å‘åŠ›ï¼Œé€‚åˆæ¸…çˆ½æç¥ã€‚"},
    "æ·±é‚ƒç•™é¦™å‹ (15:30:55)": {"ratios": [0.15, 0.30, 0.55], "desc": "åŠ é‡åè°ƒæ¯”é‡ï¼Œå±•ç°æŒä¹…é­…åŠ›ã€‚"}
}

perfume_logic = {
    "æ—¥å¸¸é€šå‹¤": {"type": "EDT", "total_oil": 1.0}, "çº¦ä¼šæ´¾å¯¹": {"type": "EDP", "total_oil": 1.5},
    "å•†åŠ¡æ­£å¼": {"type": "EDP", "total_oil": 1.2}, "è¿åŠ¨ä¼‘é—²": {"type": "Cologne", "total_oil": 0.8},
    "å†¥æƒ³ç¡çœ ": {"type": "Mist", "total_oil": 0.6}
}

# ==========================================
# æ•°æ®åº“ Gï¼šåœºæ™¯åå¥½é¢˜ç›®
# ==========================================
scene_questions = [
    {
        "question": "é—­ä¸Šçœ¼ç›ï¼Œæƒ³åƒä¸€ä¸ªè®©ä½ æœ€æ”¾æ¾çš„è‡ªç„¶ç¯å¢ƒï¼š",
        "options": [
            {"text": "ğŸŒ² é˜³å…‰ç©¿é€æ ‘å¶çš„é™è°§æ£®æ—", "scents": ["å‰è°ƒ æŸ‘è‹” 01", "å‰è°ƒ æŸ‘è‹” 04", "åè°ƒ æœ¨è´¨ 02"], "tag": "woody"},
            {"text": "ğŸŒŠ æµ·é£è½»æ‹‚çš„æ²™æ»©æµ·å²¸", "scents": ["å‰è°ƒ æŸ‘æ©˜ 05", "å‰è°ƒ æŸ‘æ©˜ 06", "ä¸­è°ƒ æœé¦™ 09"], "tag": "fresh"},
            {"text": "ğŸŒ¸ ç¹èŠ±ç››å¼€çš„æµªæ¼«èŠ±å›­", "scents": ["ä¸­è°ƒ èŠ±é¦™ 03", "ä¸­è°ƒ èŠ±é¦™ 04", "ä¸­è°ƒ èŠ±é¦™ 16"], "tag": "floral"},
            {"text": "â›°ï¸ äº‘é›¾ç¼­ç»•çš„é«˜å±±ä¹‹å·…", "scents": ["å‰è°ƒ èŠ³é¦™ 06", "åè°ƒ æœ¨è´¨ 09", "åè°ƒ ä¸œæ–¹ 07"], "tag": "fresh"}
        ]
    },
    {
        "question": "ä»€ä¹ˆæ—¶åˆ»çš„æ°›å›´æœ€èƒ½è§¦åŠ¨ä½ çš„å¿ƒï¼Ÿ",
        "options": [
            {"text": "ğŸŒ… è–„é›¾ä¸­çš„æ¸…æ™¨ï¼Œéœ²ç è¿˜æŒ‚åœ¨å¶å°–", "scents": ["å‰è°ƒ èŠ³é¦™ 09", "å‰è°ƒ èŠ³é¦™ 02", "ä¸­è°ƒ èŠ±é¦™ 06"], "tag": "fresh"},
            {"text": "â˜€ï¸ é˜³å…‰ç¿çƒ‚çš„åˆåï¼Œæš–æ´‹æ´‹çš„æƒ¬æ„", "scents": ["å‰è°ƒ æŸ‘æ©˜ 01", "å‰è°ƒ æŸ‘æ©˜ 04", "ä¸­è°ƒ æœé¦™ 01"], "tag": "citrus"},
            {"text": "ğŸŒ† åç¯åˆä¸Šçš„å‚æ™šï¼Œæµªæ¼«çš„å¾®é†ºæ—¶åˆ†", "scents": ["ä¸­è°ƒ èŠ±é¦™ 02", "ä¸­è°ƒ èŠ±é¦™ 10", "åè°ƒ ä¸œæ–¹ 01"], "tag": "oriental"},
            {"text": "ğŸŒ™ ä¸‡ç±ä¿±å¯‚çš„æ·±å¤œï¼Œç‹¬äº«é™è°§æ—¶å…‰", "scents": ["åè°ƒ æœ¨è´¨ 06", "åè°ƒ æœ¨è´¨ 08", "åè°ƒ ä¸œæ–¹ 04"], "tag": "woody"}
        ]
    },
    {
        "question": "ä»¥ä¸‹å“ªä¸ªç©ºé—´çš„æ°”å‘³è®©ä½ æœ€æ„Ÿåˆ°èˆ’é€‚ï¼Ÿ",
        "options": [
            {"text": "â˜• é£˜è‘—å’–å•¡é¦™çš„æ¸©æš–å’–å•¡é¦†", "scents": ["ä¸­è°ƒ æœé¦™ 10", "åè°ƒ ä¸œæ–¹ 04", "åè°ƒ ä¸œæ–¹ 08"], "tag": "oriental"},
            {"text": "ğŸµ æ¸…å¹½é›…è‡´çš„ä¸œæ–¹èŒ¶å®¤", "scents": ["å‰è°ƒ èŠ³é¦™ 01", "å‰è°ƒ èŠ³é¦™ 09", "åè°ƒ ä¸œæ–¹ 02"], "tag": "fresh"},
            {"text": "ğŸ‹ æ–°é²œæ°´æœå †å çš„å¤æ—¥å¸‚é›†", "scents": ["å‰è°ƒ æŸ‘æ©˜ 02", "ä¸­è°ƒ æœé¦™ 03", "ä¸­è°ƒ æœé¦™ 07"], "tag": "citrus"},
            {"text": "ğŸ¥ åˆšå‡ºç‚‰é¢åŒ…é¦™çš„çƒ˜ç„™åŠ", "scents": ["åè°ƒ ä¸œæ–¹ 05", "åè°ƒ ä¸œæ–¹ 11", "ä¸­è°ƒ èŠ±é¦™ 09"], "tag": "oriental"}
        ]
    },
    {
        "question": "å“ªç§æ´»åŠ¨çŠ¶æ€æœ€èƒ½ä»£è¡¨ä½ ç†æƒ³ä¸­çš„è‡ªå·±ï¼Ÿ",
        "options": [
            {"text": "ğŸ§˜ é™å¿ƒå†¥æƒ³ï¼Œä¸å†…åœ¨å¯¹è¯", "scents": ["åè°ƒ æœ¨è´¨ 08", "åè°ƒ æœ¨è´¨ 13", "å‰è°ƒ æŸ‘è‹” 04"], "tag": "woody"},
            {"text": "ğŸ’ƒ æ´¾å¯¹ç‹‚æ¬¢ï¼Œé‡Šæ”¾çƒ­æƒ…èƒ½é‡", "scents": ["å‰è°ƒ æŸ‘æ©˜ 04", "ä¸­è°ƒ æœé¦™ 04", "ä¸­è°ƒ æœé¦™ 07"], "tag": "citrus"},
            {"text": "ğŸ“š æ²‰æµ¸ä¹¦æµ·ï¼Œäº«å—çŸ¥è¯†æ´—ç¤¼", "scents": ["åè°ƒ ä¸œæ–¹ 04", "åè°ƒ æœ¨è´¨ 02", "å‰è°ƒ èŠ³é¦™ 05"], "tag": "woody"},
            {"text": "ğŸ’ æ¢ç´¢å†’é™©ï¼Œè¿½å¯»æœªçŸ¥åˆºæ¿€", "scents": ["å‰è°ƒ èŠ³é¦™ 08", "å‰è°ƒ æŸ‘æ©˜ 06", "åè°ƒ ä¸œæ–¹ 07"], "tag": "fresh"}
        ]
    },
    {
        "question": "å“ªä¸ªåœºæ™¯çš„æ°”å‘³ä¼šå”¤èµ·ä½ æœ€ç¾å¥½çš„å›å¿†ï¼Ÿ",
        "options": [
            {"text": "ğŸ¡ å¤–å©†å®¶çš„è€æœ¨æŸœä¸é™ˆå¹´é¦™æ°”", "scents": ["åè°ƒ æœ¨è´¨ 10", "åè°ƒ æœ¨è´¨ 11", "åè°ƒ ä¸œæ–¹ 08"], "tag": "woody"},
            {"text": "ğŸ¨ é«˜çº§é¥­åº—çš„ä¼˜é›…å¤§å…é¦™æ°›", "scents": ["ä¸­è°ƒ èŠ±é¦™ 02", "ä¸­è°ƒ èŠ±é¦™ 11", "åè°ƒ æœ¨è´¨ 13"], "tag": "floral"},
            {"text": "ğŸŒ¾ ä¹¡é—´ç”°é‡çš„é’è‰ä¸æ³¥åœŸæ°”æ¯", "scents": ["å‰è°ƒ èŠ³é¦™ 02", "å‰è°ƒ æŸ‘è‹” 04", "ä¸­è°ƒ èŠ±é¦™ 06"], "tag": "fresh"},
            {"text": "ğŸŒƒ éƒ½å¸‚å¤œæ™šçš„æ—¶å°šä¸ç¥ç§˜", "scents": ["åè°ƒ ä¸œæ–¹ 03", "åè°ƒ ä¸œæ–¹ 09", "åè°ƒ æœ¨è´¨ 06"], "tag": "oriental"}
        ]
    }
]

# ==========================================
# æ•°æ®åº“ Hï¼šå­£èŠ‚åå¥½ä¸é¦™å‘³å¯¹åº”
# ==========================================
season_scents = {
    "ğŸŒ¸ æ˜¥å¤© - ä¸‡ç‰©å¤è‹ï¼Œç”Ÿæœºç›ç„¶": {
        "top": ["å‰è°ƒ èŠ³é¦™ 02", "å‰è°ƒ èŠ³é¦™ 03", "å‰è°ƒ æŸ‘æ©˜ 01"],
        "mid": ["ä¸­è°ƒ èŠ±é¦™ 05", "ä¸­è°ƒ èŠ±é¦™ 06", "ä¸­è°ƒ èŠ±é¦™ 07"],
        "base": ["åè°ƒ æœ¨è´¨ 02", "åè°ƒ æœ¨è´¨ 07"],
        "desc": "æ˜¥å­£é¦™æ°›ä»¥æ¸…æ–°èŠ±é¦™ä¸ºä¸»è°ƒï¼Œå¸¦æ¥æ–°ç”Ÿçš„å¸Œæœ›ä¸æ´»åŠ›ã€‚"
    },
    "â˜€ï¸ å¤å¤© - é˜³å…‰ç¿çƒ‚ï¼Œçƒ­æƒ…å¥”æ”¾": {
        "top": ["å‰è°ƒ æŸ‘æ©˜ 04", "å‰è°ƒ æŸ‘æ©˜ 05", "å‰è°ƒ æŸ‘æ©˜ 06"],
        "mid": ["ä¸­è°ƒ æœé¦™ 02", "ä¸­è°ƒ æœé¦™ 05", "ä¸­è°ƒ æœé¦™ 09"],
        "base": ["åè°ƒ ä¸œæ–¹ 06", "åè°ƒ æœ¨è´¨ 12"],
        "desc": "å¤å­£é¦™æ°›ä»¥æŸ‘æ©˜æœé¦™ä¸ºä¸»è°ƒï¼Œæ¸…çˆ½æç¥ï¼Œå……æ»¡æ´»åŠ›ã€‚"
    },
    "ğŸ‚ ç§‹å¤© - é‡‘é£é€çˆ½ï¼Œæ²‰ç¨³å†…æ•›": {
        "top": ["å‰è°ƒ èŠ³é¦™ 01", "å‰è°ƒ èŠ³é¦™ 05", "å‰è°ƒ æŸ‘è‹” 01"],
        "mid": ["ä¸­è°ƒ èŠ±é¦™ 19", "ä¸­è°ƒ èŠ±é¦™ 08", "ä¸­è°ƒ æœé¦™ 01"],
        "base": ["åè°ƒ æœ¨è´¨ 03", "åè°ƒ æœ¨è´¨ 10", "åè°ƒ ä¸œæ–¹ 02"],
        "desc": "ç§‹å­£é¦™æ°›ä»¥æœ¨è´¨æ¸©æš–ä¸ºä¸»è°ƒï¼Œæ²‰ç¨³å¤§æ°”ï¼ŒéŸµå‘³æ‚ é•¿ã€‚"
    },
    "â„ï¸ å†¬å¤© - é™è°§æ·±é‚ƒï¼Œæ¸©æš–ç–—æ„ˆ": {
        "top": ["å‰è°ƒ èŠ³é¦™ 01", "å‰è°ƒ æŸ‘è‹” 02", "å‰è°ƒ èŠ³é¦™ 07"],
        "mid": ["ä¸­è°ƒ èŠ±é¦™ 08", "ä¸­è°ƒ èŠ±é¦™ 09", "ä¸­è°ƒ æœé¦™ 10"],
        "base": ["åè°ƒ ä¸œæ–¹ 08", "åè°ƒ æœ¨è´¨ 08", "åè°ƒ ä¸œæ–¹ 05"],
        "desc": "å†¬å­£é¦™æ°›ä»¥ä¸œæ–¹æš–é¦™ä¸ºä¸»è°ƒï¼Œå¦‚å£ç‚‰èˆ¬æ¸©æš–ï¼ŒæŠšæ…°å¿ƒçµã€‚"
    }
}

# ==========================================
# æ•°æ®åº“ Cï¼šMBTI ç®€æ˜“æµ‹è¯•é¢˜ç›®
# ==========================================
mbti_questions = [
    # E/I ç»´åº¦
    {"dimension": "EI", "question": "åœ¨ç¤¾äº¤åœºåˆä¸­ï¼Œä½ é€šå¸¸ä¼šï¼š",
     "options": [("ä¸»åŠ¨è®¤è¯†æ–°æœ‹å‹ï¼Œäº«å—äº¤æµ", "E"), ("å¾…åœ¨ç†Ÿæ‚‰çš„äººæ—è¾¹ï¼Œæˆ–æ‰¾å®‰é™è§’è½", "I")]},
    {"dimension": "EI", "question": "ç»è¿‡å¿™ç¢Œçš„ä¸€å¤©åï¼Œä½ å€¾å‘ç”¨ä»€ä¹ˆæ–¹å¼å……ç”µï¼Ÿ",
     "options": [("å’Œæœ‹å‹èšä¼šèŠå¤©", "E"), ("ç‹¬å¤„æˆ–å®‰é™åœ°ä¼‘æ¯", "I")]},
    # S/N ç»´åº¦
    {"dimension": "SN", "question": "ä½ åœ¨æ€è€ƒäº‹æƒ…æ—¶ï¼Œæ›´æ³¨é‡ï¼š",
     "options": [("å…·ä½“çš„äº‹å®å’Œç»†èŠ‚", "S"), ("æ•´ä½“æ¦‚å¿µå’Œæœªæ¥å¯èƒ½æ€§", "N")]},
    {"dimension": "SN", "question": "ä½ æ›´ç›¸ä¿¡ï¼š",
     "options": [("å®é™…ç»éªŒå’Œçœ¼è§ä¸ºå‡­", "S"), ("ç›´è§‰å’Œç¬¬å…­æ„Ÿ", "N")]},
    # T/F ç»´åº¦
    {"dimension": "TF", "question": "åšé‡è¦å†³å®šæ—¶ï¼Œä½ æ›´ä¾èµ–ï¼š",
     "options": [("å®¢è§‚çš„é€»è¾‘åˆ†æ", "T"), ("ä¸ªäººä»·å€¼è§‚å’Œå¯¹ä»–äººçš„å½±å“", "F")]},
    {"dimension": "TF", "question": "å½“æœ‹å‹é‡åˆ°å›°éš¾å‘ä½ å€¾è¯‰æ—¶ï¼Œä½ ä¼šå…ˆï¼š",
     "options": [("å¸®å¿™åˆ†æé—®é¢˜å¹¶æä¾›è§£å†³æ–¹æ¡ˆ", "T"), ("å€¾å¬å¹¶ç»™äºˆæƒ…æ„Ÿæ”¯æŒ", "F")]},
    # J/P ç»´åº¦
    {"dimension": "JP", "question": "å¯¹äºç”Ÿæ´»å’Œå·¥ä½œï¼Œä½ æ›´å–œæ¬¢ï¼š",
     "options": [("äº‹å…ˆè®¡åˆ’å¥½ï¼ŒæŒ‰éƒ¨å°±ç­", "J"), ("ä¿æŒå¼¹æ€§ï¼Œéšæœºåº”å˜", "P")]},
    {"dimension": "JP", "question": "é¢å¯¹æˆªæ­¢æ—¥æœŸï¼Œä½ é€šå¸¸ä¼šï¼š",
     "options": [("æå‰å®Œæˆï¼Œé¿å…å‹åŠ›", "J"), ("åœ¨æœ€åæœŸé™å‰æ‰å®Œæˆï¼Œäº«å—å‹åŠ›å¸¦æ¥çš„åŠ¨åŠ›", "P")]},
]

def calculate_mbti(answers):
    """æ ¹æ®æµ‹è¯•ç­”æ¡ˆè®¡ç®— MBTI ç±»å‹"""
    scores = {"E": 0, "I": 0, "S": 0, "N": 0, "T": 0, "F": 0, "J": 0, "P": 0}
    for ans in answers:
        if ans:
            scores[ans] += 1

    mbti = ""
    mbti += "E" if scores["E"] >= scores["I"] else "I"
    mbti += "S" if scores["S"] >= scores["N"] else "N"
    mbti += "T" if scores["T"] >= scores["F"] else "F"
    mbti += "J" if scores["J"] >= scores["P"] else "P"

    # å¯¹åº”åˆ°å®Œæ•´çš„ MBTI åç§°
    mbti_names = {
        "INTJ": "INTJ (å»ºç­‘å¸ˆ)", "INFP": "INFP (è°ƒè§£è€…)", "INFJ": "INFJ (æå€¡è€…)",
        "ENFP": "ENFP (ç«é€‰è€…)", "ENTJ": "ENTJ (æŒ‡æŒ¥å®˜)", "ENTP": "ENTP (è¾©è®ºå®¶)",
        "ENFJ": "ENFJ (ä¸»äººå…¬)", "ISTJ": "ISTJ (ç‰©æµå¸ˆ)", "ISFJ": "ISFJ (å®ˆå«è€…)",
        "ESTJ": "ESTJ (æ€»ç»ç†)", "ESFJ": "ESFJ (æ‰§æ”¿å®˜)", "ISTP": "ISTP (é‰´èµå®¶)",
        "ISFP": "ISFP (æ¢é™©å®¶)", "ESTP": "ESTP (ä¼ä¸šå®¶)", "ESFP": "ESFP (è¡¨æ¼”è€…)",
        "INTP": "INTP (é€»è¾‘å­¦å®¶)"
    }
    return mbti_names.get(mbti, f"{mbti}")

# ==========================================
# æ ¸å¿ƒå‡½æ•°
# ==========================================
def generate_all_reasons(all_codes, personality_info):
    """
    ä¸ºæ‰€æœ‰é¦™å‘³ä¸€æ¬¡æ€§ç”Ÿæˆä¸é‡å¤çš„ä¸ªæ€§åŒ¹é…è¯´æ˜
    all_codes: æ‰€æœ‰é¦™å‘³ä»£ç åˆ—è¡¨ (å‰è°ƒ+ä¸­è°ƒ+åè°ƒ)
    personality_info: ä¸ªæ€§èµ„è®¯å­—å…¸
    è¿”å›: {code: reason_text} å­—å…¸
    """
    if not personality_info:
        return {}

    # ä¸ºæ¯ä¸ªæ¥æºåˆ›å»ºå¤šä¸ªä¸åŒçš„æ¨¡æ¿ï¼Œä½¿ç”¨ä¸°å¯Œå¤šæ ·çš„è¯æ±‡
    all_templates = []

    # æ˜Ÿåº§æ¨¡æ¿ (10ä¸ªï¼Œå¤šæ ·åŒ–è¯æ±‡)
    if personality_info.get("zodiac_trait"):
        zodiac = personality_info.get("zodiac", "")
        trait = personality_info.get("zodiac_trait")
        all_templates.extend([
            ("zodiac", "{ing}çš„é¦™å‘³å‘¼åº”ä½ èº«ä¸º" + zodiac + trait + "çš„ç‰¹è´¨"),
            ("zodiac", "ä½œä¸º" + zodiac + "çš„ä½ ï¼Œ{ing}çš„æ°”æ¯èƒ½è¡¬æ‰˜ä½ " + trait + "çš„çµé­‚"),
            ("zodiac", zodiac + "å¤©ç”Ÿ" + trait + "ï¼Œ{ing}çš„é¦™æ°”æ­£å¥½èƒ½æ”¾å¤§è¿™ä»½é­…åŠ›"),
            ("zodiac", "{ing}ä¸" + zodiac + trait + "çš„æ˜Ÿè±¡èƒ½é‡å®Œç¾å¥‘åˆ"),
            ("zodiac", "ä½ çš„" + zodiac + "æœ¬å‘½" + trait + "ï¼Œ{ing}èƒ½ä¸ºä½ å¢æ·»ç‹¬ç‰¹å…‰å½©"),
            ("zodiac", "{ing}çš„æ°”æ¯èƒ½å”¤é†’" + zodiac + "å†…åœ¨" + trait + "çš„åŠ›é‡"),
            ("zodiac", zodiac + "å®ˆæŠ¤æ˜Ÿèµ‹äºˆä½ " + trait + "çš„æ°”åœºï¼Œ{ing}æ˜¯æœ€ä½³æ­é…"),
            ("zodiac", "{ing}çš„è°ƒæ€§æ°å¥½æ˜ ç…§" + zodiac + trait + "çš„æ˜Ÿç›˜ç‰¹è´¨"),
            ("zodiac", "ä½ " + zodiac + "çš„" + trait + "å…‰ç¯ï¼Œå› {ing}è€Œæ›´åŠ é—ªè€€"),
            ("zodiac", "{ing}èƒ½å¼•å¯¼" + zodiac + trait + "çš„å®‡å®™èƒ½é‡æµåŠ¨"),
        ])

    # MBTI æ¨¡æ¿ (10ä¸ªï¼Œå¤šæ ·åŒ–è¯æ±‡)
    if personality_info.get("mbti_trait"):
        mbti = personality_info.get("mbti", "").split(" ")[0]
        trait = personality_info.get("mbti_trait")
        all_templates.extend([
            ("mbti", "{ing}çš„é¦™å‘³ç¬¦åˆä½ " + trait + "çš„æ€§æ ¼åº•è•´"),
            ("mbti", "ä½ çš„ " + mbti + " äººæ ¼" + trait + "ï¼Œä¸{ing}çš„æ°”è´¨å®Œç¾å…±é¸£"),
            ("mbti", "ä½œä¸º " + mbti + " å‹äººæ ¼ï¼Œ{ing}èƒ½å±•ç°ä½ " + trait + "çš„ä¸€é¢"),
            ("mbti", "{ing}çš„è°ƒæ€§ä¸ " + mbti + " " + trait + "çš„å¿ƒç†ç‰¹è´¨ç›¸è¾…ç›¸æˆ"),
            ("mbti", "ä½ " + trait + "çš„ " + mbti + " æ€§æ ¼ï¼Œä¸{ing}äº§ç”Ÿç¾å¦™çš„åŒ–å­¦ååº”"),
            ("mbti", "{ing}èƒ½å¼ºåŒ–ä½  " + mbti + " äººæ ¼ä¸­" + trait + "çš„é­…åŠ›"),
            ("mbti", mbti + " çš„è®¤çŸ¥åŠŸèƒ½" + trait + "ï¼Œ{ing}èƒ½å°†å…¶å…·è±¡åŒ–"),
            ("mbti", "{ing}ä¸ºä½  " + mbti + " äººæ ¼" + trait + "çš„å†…å¿ƒä¸–ç•Œå¢è‰²"),
            ("mbti", "ä½ " + trait + "çš„æ€ç»´æ¨¡å¼ï¼Œä¸{ing}çš„é¦™è°ƒå¼‚æ›²åŒå·¥"),
            ("mbti", "{ing}å‘¼åº” " + mbti + " å‹äºº" + trait + "çš„ç²¾ç¥è¿½æ±‚"),
        ])

    # äº”è¡Œæ¨¡æ¿ (10ä¸ªï¼Œå¤šæ ·åŒ–è¯æ±‡) - å«æ°´æ™¶æ¨è
    if personality_info.get("element_trait"):
        element = personality_info.get("element", "")
        trait = personality_info.get("element_trait")

        # äº”è¡Œå¯¹åº”æ°´æ™¶é¢œè‰²ä¸è¡¥å……å…ƒç´ 
        crystal_info = {
            "é‡‘": {"crystals": "ç™½æ°´æ™¶ã€é’›æ™¶ã€é‡‘å‘æ™¶", "color": "ç™½è‰²ã€é‡‘è‰²", "enhance": "åœŸ", "enhance_crystal": "é»„æ°´æ™¶ã€è™çœ¼çŸ³"},
            "æœ¨": {"crystals": "ç»¿å¹½çµã€ç»¿å‘æ™¶ã€ä¸œè±ç‰", "color": "ç»¿è‰²", "enhance": "æ°´", "enhance_crystal": "æµ·è“å®ã€é»‘æ›œçŸ³"},
            "æ°´": {"crystals": "æµ·è“å®ã€é»‘æ›œçŸ³ã€è“çº¹ç›ç‘™", "color": "è“è‰²ã€é»‘è‰²", "enhance": "é‡‘", "enhance_crystal": "ç™½æ°´æ™¶ã€é’›æ™¶"},
            "ç«": {"crystals": "çº¢ç›ç‘™ã€ç´«æ°´æ™¶ã€çŸ³æ¦´çŸ³", "color": "çº¢è‰²ã€ç´«è‰²", "enhance": "æœ¨", "enhance_crystal": "ç»¿å¹½çµã€ç»¿å‘æ™¶"},
            "åœŸ": {"crystals": "é»„æ°´æ™¶ã€è™çœ¼çŸ³ã€èŒ¶æ™¶", "color": "é»„è‰²ã€æ£•è‰²", "enhance": "ç«", "enhance_crystal": "çº¢ç›ç‘™ã€ç´«æ°´æ™¶"}
        }

        info = crystal_info.get(element, {"crystals": "ç™½æ°´æ™¶", "color": "é€æ˜", "enhance": "åœŸ", "enhance_crystal": "é»„æ°´æ™¶"})
        crystal_tip = f"ğŸ’ æ¨èæ­é…{info['color']}ç³»æ°´æ™¶å¦‚{info['crystals']}ï¼Œæˆ–è¡¥{info['enhance']}è¡Œå¯é€‰{info['enhance_crystal']}"

        all_templates.extend([
            ("element", "{ing}çš„é¦™å‘³èƒ½å¹³è¡¡ä½ " + element + "å±æ€§" + trait + "çš„èƒ½é‡ã€‚" + crystal_tip),
            ("element", "ä½ çš„äº”è¡Œå±" + element + "ï¼Œ{ing}èƒ½æ»‹å…»ä½ " + trait + "çš„å†…åœ¨ã€‚" + crystal_tip),
            ("element", element + "è¡Œä¹‹äºº" + trait + "ï¼Œ{ing}èƒ½ä¸ºä½ å¸¦æ¥å’Œè°ã€‚" + crystal_tip),
            ("element", "{ing}ä¸ä½ çš„" + element + "è¡Œèƒ½é‡" + trait + "ç›¸äº’å‘¼åº”ã€‚" + crystal_tip),
            ("element", "äº”è¡Œ" + element + "èµ‹äºˆä½ " + trait + "çš„æœ¬è´¨ï¼Œ{ing}èƒ½å°†å…¶å‡åã€‚" + crystal_tip),
            ("element", "{ing}çš„æ°”æ¯èƒ½è°ƒå’Œä½ " + element + "å±æ€§ä¸­" + trait + "çš„ç‰¹è´¨ã€‚" + crystal_tip),
            ("element", element + "å‘½æ ¼" + trait + "ï¼Œ{ing}ä¸ºä½ è¡¥è¶³å¤©åœ°çµæ°”ã€‚" + crystal_tip),
            ("element", "{ing}ä¸" + element + "è¡Œ" + trait + "çš„ç£åœºå½¢æˆå…±æŒ¯ã€‚" + crystal_tip),
            ("element", "ä½ " + element + "å±æ€§" + trait + "çš„æ ¹åŸºï¼Œå› {ing}è€Œæ›´ç¨³å›ºã€‚" + crystal_tip),
            ("element", "{ing}èƒ½ç–é€š" + element + "è¡Œ" + trait + "çš„æ°”è„‰è¿è¡Œã€‚" + crystal_tip),
        ])

    # ç”Ÿå‘½çµæ•°æ¨¡æ¿ (10ä¸ªï¼Œå¤šæ ·åŒ–è¯æ±‡)
    if personality_info.get("life_num_trait"):
        life_num = personality_info.get("life_num", "")
        trait = personality_info.get("life_num_trait")
        all_templates.extend([
            ("life_num", "ä½œä¸º " + life_num + " å·äººï¼Œ{ing}çš„é¦™æ°”å‘¼åº”ä½ " + trait + "çš„å¤©èµ‹"),
            ("life_num", "{ing}çš„æ°”æ¯ä¸ä½  " + life_num + " å·äºº" + trait + "çš„ç‰¹è´¨ç›¸å¾—ç›Šå½°"),
            ("life_num", "ç”Ÿå‘½çµæ•° " + life_num + " èµ‹äºˆä½ " + trait + "çš„èƒ½é‡ï¼Œ{ing}æ­£å¥½èƒ½æ”¾å¤§å®ƒ"),
            ("life_num", "{ing}èƒ½æ¿€å‘ " + life_num + " å·äººå†…åœ¨" + trait + "çš„æ½œèƒ½"),
            ("life_num", "ä½  " + life_num + " å·äºº" + trait + "çš„ç‰¹è´¨ï¼Œä¸{ing}çš„é¦™è°ƒä¸è°‹è€Œåˆ"),
            ("life_num", "{ing}ä¸º " + life_num + " å·äºº" + trait + "çš„çµé­‚æ³¨å…¥æ´»åŠ›"),
            ("life_num", "æ•°å­— " + life_num + " çš„æŒ¯åŠ¨é¢‘ç‡" + trait + "ï¼Œä¸{ing}åŒé¢‘å…±æŒ¯"),
            ("life_num", "{ing}èƒ½ç‚¹äº® " + life_num + " å·äºº" + trait + "çš„ç”Ÿå‘½è“å›¾"),
            ("life_num", "ä½ ä¸ç”Ÿä¿±æ¥ " + life_num + " å·äºº" + trait + "çš„ä½¿å‘½ï¼Œ{ing}åŠ©ä½ ç»½æ”¾"),
            ("life_num", "{ing}çš„èƒ½é‡æ³¢ä¸ " + life_num + " å·äºº" + trait + "çš„é¢‘ç‡å®Œç¾è°ƒè°"),
        ])

    # ç”Ÿè‚–æ¨¡æ¿ (10ä¸ªï¼Œå¤šæ ·åŒ–è¯æ±‡)
    if personality_info.get("chinese_zodiac_trait"):
        c_zodiac = personality_info.get("chinese_zodiac", "")
        trait = personality_info.get("chinese_zodiac_trait")
        all_templates.extend([
            ("chinese_zodiac", "å±" + c_zodiac + "çš„ä½ " + trait + "ï¼Œ{ing}çš„é¦™å‘³èƒ½å¼ºåŒ–è¿™ä»½èƒ½é‡"),
            ("chinese_zodiac", "{ing}ä¸ç”Ÿè‚–" + c_zodiac + trait + "çš„æ°”è´¨ç›¸äº’è¾‰æ˜ "),
            ("chinese_zodiac", "ç”Ÿè‚–" + c_zodiac + "å¤©ç”Ÿ" + trait + "ï¼Œ{ing}èƒ½ä¸ºä½ é”¦ä¸Šæ·»èŠ±"),
            ("chinese_zodiac", "{ing}çš„é¦™æ°”èƒ½æå‡å±" + c_zodiac + "è€…" + trait + "çš„é­…åŠ›"),
            ("chinese_zodiac", "ä½ å±" + c_zodiac + "çš„" + trait + "æœ¬æ€§ï¼Œä¸{ing}çš„è°ƒæ€§å®Œç¾èåˆ"),
            ("chinese_zodiac", "{ing}èƒ½å”¤é†’ç”Ÿè‚–" + c_zodiac + trait + "çš„å†…åœ¨èƒ½é‡"),
            ("chinese_zodiac", c_zodiac + "å¹´ç”Ÿäºº" + trait + "çš„ç¦è¿ï¼Œ{ing}ä¸ºä½ åŠ æŒ"),
            ("chinese_zodiac", "{ing}ä¸å±" + c_zodiac + "è€…" + trait + "çš„å‘½æ ¼ç›¸è¾…ç›¸æˆ"),
            ("chinese_zodiac", "ä½ " + c_zodiac + "ç”Ÿè‚–" + trait + "çš„çµåŠ¨ï¼Œå› {ing}è€Œæ›´é²œæ˜"),
            ("chinese_zodiac", "{ing}èƒ½å‚¬æ—ºå±" + c_zodiac + "ä¹‹äºº" + trait + "çš„å¥½è¿æ°”åœº"),
        ])

    # æ‰“ä¹±æ¨¡æ¿é¡ºåºï¼Œç¡®ä¿éšæœºæ€§
    random.shuffle(all_templates)

    # ä¸ºæ¯ä¸ªé¦™å‘³åˆ†é…ä¸åŒçš„è¯´æ˜
    reasons = {}
    used_templates = set()

    for code in all_codes:
        full_info = scent_map.get(code, f"{code} (ä¸“å±é…æ–¹)")
        ing_raw = full_info.split(" (")[1].rstrip(")") if " (" in full_info else ""

        if not ing_raw:
            continue

        # æ‰¾ä¸€ä¸ªè¿˜æ²¡ç”¨è¿‡çš„æ¨¡æ¿
        chosen_text = None
        for idx, (source, template) in enumerate(all_templates):
            if idx not in used_templates:
                chosen_text = template.replace("{ing}", ing_raw)
                used_templates.add(idx)
                break

        # å¦‚æœæ‰€æœ‰æ¨¡æ¿éƒ½ç”¨å®Œäº†ï¼Œä»å¤´å¼€å§‹ä½†ç¡®ä¿ä¸è¿ç»­é‡å¤
        if not chosen_text and all_templates:
            idx = len(used_templates) % len(all_templates)
            source, template = all_templates[idx]
            chosen_text = template.replace("{ing}", ing_raw)

        if chosen_text:
            reasons[code] = chosen_text

    return reasons


def translate_scents(code_list, personality_info=None, pre_generated_reasons=None):
    """
    æ˜¾ç¤ºé¦™å‘³å»ºè®®ï¼Œæ”¯æ´æ˜¾ç¤ºä¸ªæ€§åŒ¹é…è¯´æ˜
    pre_generated_reasons: é¢„å…ˆç”Ÿæˆçš„è¯´æ˜å­—å…¸ {code: reason_text}
    """
    html_snippets = ""

    for code in code_list:
        full_info = scent_map.get(code, f"{code} (ä¸“å±é…æ–¹)")
        name = full_info.split(" (")[0] if " (" in full_info else full_info
        ing = "(" + full_info.split(" (")[1] if " (" in full_info else ""
        desc = scent_descriptions.get(code, "è¿™æ¬¾é¦™æ°”èƒ½ä¼˜é›…å¹³è¡¡ä½ çš„å†…åœ¨èƒ½é‡ã€‚")

        # ä½¿ç”¨é¢„å…ˆç”Ÿæˆçš„è¯´æ˜
        match_reason = ""
        if pre_generated_reasons and code in pre_generated_reasons:
            reason_text = pre_generated_reasons[code]
            match_reason = f"<div style='font-size: 14px; color: #6B4E3D; margin-top:8px; padding:10px; background:rgba(139,69,19,0.08); border-radius:8px;'>ğŸ’« <b>ä¸ºä½•é€‚åˆä½ ï¼š</b>{reason_text}</div>"

        html_snippets += f"<div style='margin-bottom:12px; padding:14px; border-radius:12px; background:rgba(255,255,255,0.6); border:1px solid #e0d5c7;'><div style='color: #8B4513; font-weight: bold; font-size: 18px;'>å»ºè®®ï¼š{name}</div><div style='font-size: 14px; color: #666; margin-top:4px;'>{ing}</div><div style='font-size: 14px; color: #9E7E6B; margin-top:8px; line-height:1.6;'><i>{desc}</i></div>{match_reason}</div>"
    return html_snippets

def get_zodiac(m, d):
    signs = [(1,20,"æ‘©ç¾¯åº§"),(2,19,"æ°´ç“¶åº§"),(3,21,"åŒé±¼åº§"),(4,20,"ç™½ç¾Šåº§"),(5,21,"é‡‘ç‰›åº§"),(6,22,"åŒå­åº§"),(7,23,"å·¨èŸ¹åº§"),(8,23,"ç‹®å­åº§"),(9,23,"å¤„å¥³åº§"),(10,24,"å¤©ç§¤åº§"),(11,23,"å¤©èåº§"),(12,22,"å°„æ‰‹åº§"),(12,31,"æ‘©ç¾¯åº§")]
    for mm, dd, s in signs:
        if m < mm or (m == mm and d <= dd): return s
    return "æ‘©ç¾¯åº§"

def get_life_num(bday):
    d = "".join(filter(str.isdigit, str(bday)))
    while len(d) > 1: d = str(sum(int(x) for x in d))
    return d

def get_chinese_zodiac(year):
    animals = ["çŒ´", "é¸¡", "ç‹—", "çŒª", "é¼ ", "ç‰›", "è™", "å…”", "é¾™", "è›‡", "é©¬", "ç¾Š"]
    return animals[year % 12]

# ==========================================
# åˆ†é¡µæ§åˆ¶é€»è¾‘ (Step-by-Step)
# ==========================================
st.title("ğŸ§ª Aroma's Secret Lab")

if "step" not in st.session_state:
    st.session_state.step = 1

# è¿›åº¦æ¡ (ç°åœ¨æœ‰ 5 ä¸ªæ­¥éª¤)
progress_map = {1: 0.2, 2: 0.4, 3: 0.6, 4: 0.8, 5: 1.0}
current_progress = progress_map.get(st.session_state.step, 1.0)
if st.session_state.get("taking_mbti_test", False):
    current_progress = 0.4  # æµ‹è¯•ä¸­ä¹Ÿæ˜¾ç¤º 40%
st.progress(current_progress)

# --- Step 1: å‘½è¿åŸºç›˜ ---
if st.session_state.step == 1:
    st.subheader("Step 1: ğŸŒŒ å‘½è¿åŸºç›˜èƒ½é‡")
    st.info("AI å°†æ ¹æ®æ‚¨çš„å‡ºç”Ÿæ—¶åˆ»ï¼Œå®šä½æ˜Ÿç›˜åæ ‡ã€ç”Ÿè‚–äº”è¡Œä¸å…«å­—èƒ½é‡ã€‚")

    st.session_state.birthday = st.date_input("ğŸ“… æ‚¨çš„å‡ºç”Ÿå¹´æœˆæ—¥", value=date(2000, 1, 1), key="step1_birthday")

    # æ—¶è¾°é€‰æ‹©
    st.markdown("**ğŸ• æ‚¨çš„å‡ºç”Ÿæ—¶è¾°**")
    know_birth_hour = st.radio(
        "æ‚¨çŸ¥é“å‡ºç”Ÿæ—¶è¾°å—ï¼Ÿ",
        ["çŸ¥é“", "ä¸çŸ¥é“/ä¸ç¡®å®š"],
        horizontal=True,
        key="know_birth_hour"
    )

    if know_birth_hour == "çŸ¥é“":
        st.session_state.birth_hour = st.selectbox(
            "è¯·é€‰æ‹©å‡ºç”Ÿæ—¶è¾°",
            list(HOUR_BRANCHES.keys()),
            key="step1_hour"
        )
        st.session_state.know_hour = True
    else:
        st.session_state.birth_hour = None
        st.session_state.know_hour = False
        st.caption("ğŸ’¡ ä¸çŸ¥é“æ—¶è¾°ä¹Ÿæ²¡å…³ç³»ï¼Œæˆ‘ä»¬ä¼šç”¨ç®€åŒ–ç‰ˆè®¡ç®—ä¸ºæ‚¨åˆ†æ")

    if st.button("ä¸‹ä¸€æ­¥ï¼šæ¢ç´¢æ€§æ ¼åŸºå›  â”"):
        st.session_state.step = 2
        st.rerun()

# --- Step 2: æ€§æ ¼åŸºå›  ---
elif st.session_state.step == 2:
    st.subheader("Step 2: ğŸ§  å†…åœ¨æ€§æ ¼åŸºå› ")
    st.info("æ€§æ ¼å½±å“é¦™å‘³çš„ä¸­è°ƒé€‰æ‹©ï¼Œè¿™æ˜¯é¦™æ°´çš„çµé­‚æ ¸å¿ƒã€‚")

    # æ£€æŸ¥æ˜¯å¦æ­£åœ¨è¿›è¡Œ MBTI æµ‹è¯•
    if st.session_state.get("taking_mbti_test", False):
        st.markdown("### ğŸ“ MBTI ç®€æ˜“æµ‹è¯•")
        st.caption("è¯·æ ¹æ®ç›´è§‰é€‰æ‹©æœ€ç¬¦åˆä½ çš„é€‰é¡¹ï¼ˆå…± 8 é¢˜ï¼‰")

        # åˆå§‹åŒ–ç­”æ¡ˆåˆ—è¡¨
        if "mbti_answers" not in st.session_state:
            st.session_state.mbti_answers = [None] * 8

        # æ˜¾ç¤ºæ‰€æœ‰é¢˜ç›®
        for i, q in enumerate(mbti_questions):
            st.markdown(f"**Q{i+1}. {q['question']}**")
            options = [opt[0] for opt in q["options"]]

            # ä½¿ç”¨ radio è®©ç”¨æˆ·é€‰æ‹©
            choice = st.radio(
                f"é€‰æ‹© Q{i+1}",
                options=options,
                index=None,
                key=f"mbti_q_{i}",
                label_visibility="collapsed"
            )

            # è®°å½•ç­”æ¡ˆ
            if choice:
                for opt_text, opt_value in q["options"]:
                    if choice == opt_text:
                        st.session_state.mbti_answers[i] = opt_value
                        break
            st.markdown("---")

        col1, col2 = st.columns(2)
        with col1:
            if st.button("â¬… è¿”å›é€‰æ‹© MBTI"):
                st.session_state.taking_mbti_test = False
                st.session_state.mbti_answers = [None] * 8
                st.rerun()
        with col2:
            # æ£€æŸ¥æ˜¯å¦æ‰€æœ‰é¢˜ç›®éƒ½å·²ä½œç­”
            all_answered = all(ans is not None for ans in st.session_state.mbti_answers)
            if st.button("å®Œæˆæµ‹è¯• âœ“", disabled=not all_answered):
                # è®¡ç®— MBTI ç»“æœ
                result = calculate_mbti(st.session_state.mbti_answers)
                st.session_state.mbti_choice = result
                st.session_state.taking_mbti_test = False
                st.session_state.mbti_answers = [None] * 8
                st.session_state.show_mbti_result = True  # æ˜¾ç¤ºç»“æœé¡µé¢
                st.rerun()

        if not all_answered:
            st.warning("è¯·å®Œæˆæ‰€æœ‰é¢˜ç›®åå†ç»§ç»­")

    # æ˜¾ç¤º MBTI æµ‹è¯•ç»“æœ
    elif st.session_state.get("show_mbti_result", False):
        mbti_result = st.session_state.mbti_choice
        personality = mbti_personality.get(mbti_result, "ç‹¬ç‰¹ä¸ªæ€§")

        st.markdown("### ğŸ‰ æµ‹è¯•å®Œæˆï¼")
        st.success(f"**æ‚¨çš„ MBTI äººæ ¼ç±»å‹æ˜¯ï¼š{mbti_result}**")
        st.info(f"ğŸ’¡ **ä¸ªæ€§ç‰¹è´¨**ï¼š{personality}")

        st.markdown("---")
        if st.button("ç»§ç»­ä¸‹ä¸€æ­¥ â”", use_container_width=True):
            st.session_state.show_mbti_result = False
            st.session_state.step = 3
            st.rerun()

    else:
        # æ­£å¸¸çš„ MBTI é€‰æ‹©ä»‹é¢
        st.session_state.mbti_choice = st.selectbox(
            "ğŸ§  æ‚¨çš„ MBTI äººæ ¼",
            list(mbti_db.keys()),
            key="step2_mbti"
        )

        # æ˜¾ç¤ºé€‰æ‹©çš„ MBTI ä¸ªæ€§æè¿°
        if st.session_state.mbti_choice:
            personality = mbti_personality.get(st.session_state.mbti_choice, "ç‹¬ç‰¹ä¸ªæ€§")
            st.info(f"ğŸ’¡ **ä¸ªæ€§ç‰¹è´¨**ï¼š{personality}")

        # æ–°å¢ï¼šä¸çŸ¥é“ MBTI çš„æŒ‰é’®
        if st.button("ğŸ¤” æˆ‘ä¸çŸ¥é“æˆ‘çš„ MBTIï¼Œè¿›è¡Œæµ‹è¯•"):
            st.session_state.taking_mbti_test = True
            st.rerun()

        col1, col2 = st.columns(2)
        with col1:
            if st.button("â¬… è¿”å›ä¸Šä¸€æ­¥"):
                st.session_state.step = 1
                st.rerun()
        with col2:
            if st.button("ä¸‹ä¸€æ­¥ï¼šæ¢ç´¢æ„Ÿå®˜åå¥½ â”"):
                st.session_state.step = 3
                st.rerun()

# --- Step 3: æ„Ÿå®˜åå¥½ (åœºæ™¯ + å­£èŠ‚) ---
elif st.session_state.step == 3:
    st.subheader("Step 3: ğŸ­ æ„Ÿå®˜è®°å¿†æ¢ç´¢")
    st.info("é€è¿‡åœºæ™¯è”æƒ³ï¼Œæ‰¾å‡ºæœ€èƒ½è§¦åŠ¨ä½ å†…å¿ƒçš„é¦™æ°”ç±»å‹ã€‚")

    # åˆå§‹åŒ–åœºæ™¯ç­”æ¡ˆ
    if "scene_answers" not in st.session_state:
        st.session_state.scene_answers = [None] * 5

    # åœºæ™¯é¢˜ç›®
    st.markdown("### ğŸ–¼ï¸ åœºæ™¯è”æƒ³æµ‹è¯•")
    st.caption("è¯·é€‰æ‹©æœ€èƒ½å¼•èµ·ä½ å…±é¸£çš„é€‰é¡¹")

    for i, q in enumerate(scene_questions):
        st.markdown(f"**Q{i+1}. {q['question']}**")
        options = [opt["text"] for opt in q["options"]]

        choice = st.radio(
            f"åœºæ™¯ Q{i+1}",
            options=options,
            index=None,
            key=f"scene_q_{i}",
            label_visibility="collapsed"
        )

        if choice:
            st.session_state.scene_answers[i] = choice
        st.markdown("---")

    # å­£èŠ‚é€‰æ‹©
    st.markdown("### ğŸŒ¿ å­£èŠ‚åå¥½")
    st.session_state.season_choice = st.radio(
        "å“ªä¸ªå­£èŠ‚çš„æ°›å›´æœ€è®©ä½ æ„Ÿåˆ°èˆ’é€‚ï¼Ÿ",
        list(season_scents.keys()),
        index=None,
        key="season_select"
    )

    # æ£€æŸ¥æ˜¯å¦å®Œæˆ
    all_scenes_answered = all(ans is not None for ans in st.session_state.scene_answers)
    season_selected = st.session_state.season_choice is not None

    col1, col2 = st.columns(2)
    with col1:
        if st.button("â¬… è¿”å›ä¸Šä¸€æ­¥"):
            st.session_state.step = 2
            st.rerun()
    with col2:
        if st.button("ä¸‹ä¸€æ­¥ï¼šæ°”å‘³åœºæ™¯å»ºæ¨¡ â”", disabled=not (all_scenes_answered and season_selected)):
            st.session_state.step = 4
            st.rerun()

    if not (all_scenes_answered and season_selected):
        st.warning("è¯·å®Œæˆæ‰€æœ‰åœºæ™¯é¢˜ç›®å¹¶é€‰æ‹©å–œæ¬¢çš„å­£èŠ‚")

# --- Step 4: æ°”å‘³å»ºæ¨¡ ---
elif st.session_state.step == 4:
    st.subheader("Step 4: ğŸ“ æ°”å‘³åœºæ™¯å»ºæ¨¡")
    st.info("é€‰æ‹©ä½¿ç”¨çš„åœºåˆä¸æ‚¨åå¥½çš„é¦™æ°”ç»“æ„ã€‚")
    st.session_state.occasion = st.selectbox("ğŸ™ï¸ é¢„è®¡ä½¿ç”¨åœºåˆ", list(perfume_logic.keys()), key="step4_occ")
    st.session_state.selected_model = st.selectbox("ğŸ“ é¦™æ°”ç»“æ„æ¨¡å‹", list(model_logic.keys()), key="step4_model")

    col1, col2 = st.columns(2)
    with col1:
        if st.button("â¬… è¿”å›ä¸Šä¸€æ­¥"):
            st.session_state.step = 3
            st.rerun()
    with col2:
        if st.button("ğŸ”® å¯åŠ¨ AI æ·±åº¦åˆ†æ"):
            st.session_state.step = 5
            st.rerun()

# --- Step 5: ç»“æœå±•ç¤º ---
elif st.session_state.step == 5:
    # åˆ¤æ–­æ˜¯å¦å·²ç»è¿è¡Œè¿‡è½½å…¥åŠ¨ç”»
    if "done_loading" not in st.session_state:
        progress_bar = st.progress(0)
        status_text = st.empty()
        loading_steps = [
            {"text": "ğŸŒŒ æ­£åœ¨è°ƒå–æ˜Ÿç›˜åæ ‡ï¼Œå¯¹é½é»„é“åäºŒå®«è„‰ç»œ...", "t": 1.0},
            {"text": "ğŸ® è¯»å–ç”Ÿè‚–å‘½ç†ï¼Œè®¡ç®—äº”è¡Œèƒ½é‡æµåŠ¨...", "t": 0.8},
            {"text": "ğŸ“œ æ¨ç®—å…«å­—å‘½ç›˜ï¼Œåˆ†æäº”è¡Œç›ˆç¼º...", "t": 1.0},
            {"text": "ğŸ­ è§£æåœºæ™¯è®°å¿†ï¼Œæå–æ„Ÿå®˜åå¥½...", "t": 1.2},
            {"text": "ğŸŒ¿ èåˆå­£èŠ‚èƒ½é‡ï¼Œè°ƒå’Œé¦™æ°”é¢‘ç‡...", "t": 0.8},
            {"text": "ğŸ§ª æ­£åœ¨ä»æ°”å‘³åº“ä¸­ç­›é€‰çµé­‚æ°”å‘³åŸºå› ...", "t": 1.2},
            {"text": "ğŸ§  åŒ¹é…äººæ ¼æ ¸å¿ƒï¼Œæ’é™¤åˆ†å­æ’æ–¥ååº”...", "t": 1.0},
            {"text": "ğŸ¨ è®¡ç®— 2026 é©¬å¹´ä¸“å±å¹¸è¿è‰²...", "t": 0.6},
            {"text": "âš–ï¸ æ­£åœ¨æ ¡å‡†æœ€ä½³ 10ml è°ƒé…æ»´æ•°...", "t": 0.6}
        ]
        for i, step in enumerate(loading_steps):
            status_text.markdown(f"**{step['text']}**")
            time.sleep(step['t'])
            progress_bar.progress((i + 1) / len(loading_steps))

        status_text.empty()
        progress_bar.empty()
        st.session_state.done_loading = True
        st.rerun()

    # æ‰§è¡Œå®é™…è¿ç®—
    birthday = st.session_state.birthday
    mbti_choice = st.session_state.mbti_choice
    occasion = st.session_state.occasion
    selected_model = st.session_state.selected_model
    birth_hour = st.session_state.get("birth_hour")
    know_hour = st.session_state.get("know_hour", False)
    scene_answers = st.session_state.get("scene_answers", [])
    season_choice = st.session_state.get("season_choice", "ğŸŒ¸ æ˜¥å¤© - ä¸‡ç‰©å¤è‹ï¼Œç”Ÿæœºç›ç„¶")

    z_name = get_zodiac(birthday.month, birthday.day)
    c_zodiac = get_chinese_zodiac(birthday.year)
    c_element = zodiac_elements[c_zodiac]
    l_num = get_life_num(birthday)

    # è®¡ç®—å…«å­—äº”è¡Œ
    hour_branch = HOUR_BRANCHES.get(birth_hour) if birth_hour else None
    five_elements = calculate_five_elements(birthday, hour_branch)

    res = mbti_db[mbti_choice]
    occ_data = perfume_logic[occasion]
    model_data = model_logic[selected_model]
    z_scent = zodiac_scents.get(z_name, {"top": "å‰è°ƒ èŠ³é¦™ 01", "reason": "èƒ½é‡å¼•å¯¼"})
    e_data = element_scents.get(c_element, {"base": "åè°ƒ æœ¨è´¨ 08"})

    # è·å–çµæ•°èµ„è®¯
    life_info = life_number_db.get(l_num, life_number_db["1"])

    # è·å–å¹¸è¿è‰²
    zodiac_colors = horse_year_lucky_colors["zodiac"].get(c_zodiac, {"colors": ["é‡‘è‰²"], "avoid": "æ— ", "reason": ""})
    life_colors = horse_year_lucky_colors["life_number"].get(l_num, {"colors": ["ç™½è‰²"], "reason": ""})

    # å¤„ç†åœºæ™¯åå¥½æ¨è
    scene_scent_suggestions = {"top": [], "mid": [], "base": []}
    scene_tags = []
    for i, answer in enumerate(scene_answers):
        if answer:
            for opt in scene_questions[i]["options"]:
                if opt["text"] == answer:
                    scene_tags.append(opt["tag"])
                    for scent in opt["scents"]:
                        if scent.startswith("å‰è°ƒ"):
                            scene_scent_suggestions["top"].append(scent)
                        elif scent.startswith("ä¸­è°ƒ"):
                            scene_scent_suggestions["mid"].append(scent)
                        else:
                            scene_scent_suggestions["base"].append(scent)
                    break

    # è·å–å­£èŠ‚æ¨è
    season_data = season_scents.get(season_choice, season_scents["ğŸŒ¸ æ˜¥å¤© - ä¸‡ç‰©å¤è‹ï¼Œç”Ÿæœºç›ç„¶"])

    # æ•´åˆæ‰€æœ‰æ¨èï¼šæ˜Ÿåº§ + MBTI + åœºæ™¯ + å­£èŠ‚
    # ä¼˜å…ˆé¡ºåºï¼šåœºæ™¯åå¥½ > å­£èŠ‚ > æ˜Ÿåº§ > MBTI
    all_top = scene_scent_suggestions["top"] + season_data["top"] + [z_scent["top"]] + res['top']
    all_mid = scene_scent_suggestions["mid"] + season_data["mid"] + res['mid']
    all_base = scene_scent_suggestions["base"] + season_data["base"] + [e_data["base"]] + res['base']

    # å»é‡å¹¶é™åˆ¶ 3 ä¸ª
    final_top = list(dict.fromkeys(all_top))[:3]
    final_mid = list(dict.fromkeys(all_mid))[:3]
    final_base = list(dict.fromkeys(all_base))[:3]

    # åˆ†æåœºæ™¯åå¥½æ ‡ç­¾
    from collections import Counter
    tag_counts = Counter(scene_tags)
    dominant_tag = tag_counts.most_common(1)[0][0] if tag_counts else "balanced"
    tag_descriptions = {
        "woody": "æœ¨è´¨æ²‰ç¨³å‹ - ä½ åå¥½æ²‰é™å†…æ•›çš„æ°›å›´ï¼Œé€‚åˆå¸¦æœ‰æœ¨è´¨ã€è‹”è—“è°ƒçš„é¦™æ°”",
        "fresh": "æ¸…æ–°è‡ªç„¶å‹ - ä½ å–œæ¬¢æ¸…çˆ½é€šé€çš„æ„Ÿè§‰ï¼Œé€‚åˆç»¿å¶ã€è‰æœ¬è°ƒçš„é¦™æ°”",
        "floral": "èŠ±é¦™æµªæ¼«å‹ - ä½ æ¬£èµä¼˜é›…ç»†è…»çš„ç¾ï¼Œé€‚åˆèŠ±é¦™ã€ç²‰é¦™è°ƒçš„é¦™æ°”",
        "citrus": "æŸ‘æ©˜æ´»åŠ›å‹ - ä½ å–œæ¬¢æ˜äº®æ„‰æ‚¦çš„èƒ½é‡ï¼Œé€‚åˆæœé¦™ã€æŸ‘æ©˜è°ƒçš„é¦™æ°”",
        "oriental": "ä¸œæ–¹ç¥ç§˜å‹ - ä½ è¢«æ¸©æš–æ·±é‚ƒçš„æ°›å›´å¸å¼•ï¼Œé€‚åˆä¸œæ–¹ã€è¾›é¦™è°ƒçš„é¦™æ°”",
        "balanced": "å¹³è¡¡å’Œè°å‹ - ä½ çš„å“å‘³å¤šå…ƒåŒ…å®¹ï¼Œé€‚åˆå±‚æ¬¡ä¸°å¯Œçš„å¤åˆé¦™æ°”"
    }

    # æ˜Ÿåº§ä¸ªæ€§ç®€çŸ­æè¿°ï¼ˆç”¨äºé¦™å‘³åŒ¹é…è¯´æ˜ï¼‰
    zodiac_personality = {
        "ç™½ç¾Šåº§": "å‹‡æ•¢çƒ­æƒ…", "é‡‘ç‰›åº§": "ç¨³é‡è´¨æ„Ÿ", "åŒå­åº§": "çµåŠ¨å¥½å¥‡",
        "å·¨èŸ¹åº§": "ç»†è…»æ¸©æš–", "ç‹®å­åº§": "è‡ªä¿¡è€€çœ¼", "å¤„å¥³åº§": "ç»†å¿ƒå®Œç¾",
        "å¤©ç§¤åº§": "ä¼˜é›…å¹³è¡¡", "å¤©èåº§": "ç¥ç§˜æ·±é‚ƒ", "å°„æ‰‹åº§": "è‡ªç”±å†’é™©",
        "æ‘©ç¾¯åº§": "æ²‰ç¨³è¸å®", "æ°´ç“¶åº§": "ç‹¬ç«‹åˆ›æ–°", "åŒé±¼åº§": "æµªæ¼«æ„Ÿæ€§"
    }

    # äº”è¡Œä¸ªæ€§ç®€çŸ­æè¿°
    element_personality = {
        "æ°´": "æ™ºæ…§çµæ€§", "æœ¨": "æˆé•¿ç”Ÿæœº", "ç«": "çƒ­æƒ…æ´»åŠ›", "é‡‘": "åˆšæ¯…ç²¾å‡†", "åœŸ": "åšé‡ç¨³å®š"
    }

    # ç”Ÿå‘½çµæ•°ä¸ªæ€§ç®€çŸ­æè¿°
    life_num_personality = {
        "1": "é¢†å¯¼ç‹¬ç«‹", "2": "æ¸©å’Œåè°ƒ", "3": "åˆ›æ„è¡¨è¾¾",
        "4": "åŠ¡å®ç¨³å®š", "5": "è‡ªç”±å†’é™©", "6": "å…³æ€€è´£ä»»",
        "7": "æ™ºæ…§æ¢ç´¢", "8": "æƒå¨æˆå°±", "9": "åšçˆ±ç†æƒ³"
    }

    # ç”Ÿè‚–ä¸ªæ€§ç®€çŸ­æè¿°
    chinese_zodiac_personality = {
        "é¼ ": "æœºæ•èªæ…§", "ç‰›": "å‹¤å¥‹è¸å®", "è™": "å‹‡çŒ›æœæ•¢",
        "å…”": "æ¸©æŸ”ç»†è…»", "é¾™": "æ°”åº¦éå‡¡", "è›‡": "å†·é™ç¿æ™º",
        "é©¬": "çƒ­æƒ…å¥”æ”¾", "ç¾Š": "æ¸©å’Œå–„è‰¯", "çŒ´": "çµæ´»èªé¢–",
        "é¸¡": "å‹¤å‹‰è‡ªä¿¡", "ç‹—": "å¿ è¯šæ­£ç›´", "çŒª": "çœŸè¯šä¹è§‚"
    }

    # å»ºç«‹ä¸ªæ€§èµ„è®¯å­—å…¸ï¼Œä¼ ç»™ translate_scents
    personality_info = {
        "mbti": mbti_choice,
        "mbti_trait": mbti_personality.get(mbti_choice, "ç‹¬ç‰¹"),
        "zodiac": z_name,
        "zodiac_trait": zodiac_personality.get(z_name, "ç‹¬ç‰¹"),
        "element": c_element,
        "element_trait": element_personality.get(c_element, "å¹³è¡¡"),
        "life_num": l_num,
        "life_num_trait": life_num_personality.get(l_num, "ç‹¬ç‰¹"),
        "chinese_zodiac": c_zodiac,
        "chinese_zodiac_trait": chinese_zodiac_personality.get(c_zodiac, "ç‹¬ç‰¹")
    }

    # ä¸€æ¬¡æ€§ä¸ºæ‰€æœ‰é¦™å‘³ç”Ÿæˆä¸é‡å¤çš„è¯´æ˜
    all_scent_codes = final_top + final_mid + final_base
    pre_generated_reasons = generate_all_reasons(all_scent_codes, personality_info)

    # æ¸²æŸ“ä¸»å¡ç‰‡ - æ”¾å¤§æ ‡ç­¾å­—ä½“
    st.markdown(f"""
    <div style="background: white; padding: 25px; border-radius: 20px; border: 2px solid #1a1a1a; box-shadow: 8px 8px 0px #F5F5F5; color: #333;">
        <h2 style="text-align:center; color:#8B4513;">ğŸ§¬ AI å…¨ç»´åº¦ä¸“å±é…æ–¹</h2>
        <div style="display:flex; justify-content:center; gap:12px; margin:15px 0; flex-wrap:wrap;">
            <span style="background:#E3F2FD; padding:8px 16px; border-radius:12px; font-size:15px; font-weight:bold;">ğŸŒ  {z_name}</span>
            <span style="background:#F3E5F5; padding:8px 16px; border-radius:12px; font-size:15px; font-weight:bold;">ğŸ® {c_zodiac}å¹´ï¼ˆ{c_element}ï¼‰</span>
            <span style="background:#FFF3E0; padding:8px 16px; border-radius:12px; font-size:15px; font-weight:bold;">ğŸ§  {mbti_choice}</span>
            <span style="background:#E8F5E9; padding:8px 16px; border-radius:12px; font-size:15px; font-weight:bold;">ğŸ”¢ {l_num} å·äºº</span>
        </div>
        <div style="font-size: 13px; color: #4A5568; line-height: 1.7; background: #FAFAFA; padding: 15px; border-radius: 12px; margin-bottom: 20px; border: 0.5px solid #EDF2F7;">
            <p style="margin:0 0 10px 0;"><b>âœ¨ æ˜Ÿåº§ç‰¹è´¨ï¼š</b>{zodiac_db.get(z_name, "èƒ½é‡å¼•å¯¼è€…")}</p>
            <p style="margin:0 0 10px 0;"><b>ğŸ§  MBTI äººæ ¼ï¼š</b>{mbti_personality.get(mbti_choice, "ç‹¬ç‰¹ä¸ªæ€§")}</p>
            <p style="margin:0;"><b>â˜¯ï¸ äº”è¡Œèƒ½é‡ï¼š</b>{element_traits.get(c_element, "ç¨³å®šåº•è•´")}</p>
        </div>
        <div style="background:#FFF9F0; padding:15px; border-radius:10px; border-left: 5px solid #D4AF37;">
            <p style="font-weight:bold; margin:0; font-size:16px;">ã€å‰è°ƒå»ºè®®ã€‘</p>{translate_scents(final_top, personality_info, pre_generated_reasons)}
            <p style="font-weight:bold; margin:15px 0 0 0; font-size:16px;">ã€ä¸­è°ƒå»ºè®®ã€‘</p>{translate_scents(final_mid, personality_info, pre_generated_reasons)}
            <p style="font-weight:bold; margin:15px 0 0 0; font-size:16px;">ã€åè°ƒå»ºè®®ã€‘</p>{translate_scents(final_base, personality_info, pre_generated_reasons)}
        </div>
    </div>
    """, unsafe_allow_html=True)

    # æ„Ÿå®˜åå¥½åˆ†æå¡ç‰‡
    st.write("---")
    st.subheader("ğŸ­ æ„Ÿå®˜åå¥½åˆ†æ")

    col1, col2 = st.columns(2)
    with col1:
        st.markdown(f"""
        <div style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); padding: 20px; border-radius: 15px;">
            <h4 style="margin:0 0 10px 0; color:#333;">ğŸ–¼ï¸ ä½ çš„é¦™æ°”äººæ ¼</h4>
            <p style="font-size:14px; color:#444; line-height:1.7; margin:0;">{tag_descriptions.get(dominant_tag, tag_descriptions["balanced"])}</p>
        </div>
        """, unsafe_allow_html=True)

    with col2:
        season_emoji = season_choice.split(" ")[0]
        season_name = season_choice.split(" - ")[0].replace(season_emoji, "").strip()
        st.markdown(f"""
        <div style="background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); padding: 20px; border-radius: 15px;">
            <h4 style="margin:0 0 10px 0; color:#333;">ğŸŒ¿ å­£èŠ‚é¦™æ°”åå¥½</h4>
            <p style="font-size:18px; font-weight:bold; color:#8B4513; margin:5px 0;">{season_emoji} {season_name}</p>
            <p style="font-size:12px; color:#666; margin:0;">{season_data["desc"]}</p>
        </div>
        """, unsafe_allow_html=True)

    # å…«å­—äº”è¡Œåˆ†æå¡ç‰‡
    st.write("---")
    st.subheader("ğŸ“œ å…«å­—äº”è¡Œå‘½ç›˜åˆ†æ")

    # äº”è¡Œç»Ÿè®¡
    element_icons = {"é‡‘": "ğŸª™", "æœ¨": "ğŸŒ³", "æ°´": "ğŸ’§", "ç«": "ğŸ”¥", "åœŸ": "ï¿½iteğŸ”ï¸"}
    cols = st.columns(5)
    for i, (elem, count) in enumerate(five_elements["counts"].items()):
        with cols[i]:
            icon = {"é‡‘": "ğŸª™", "æœ¨": "ğŸŒ¿", "æ°´": "ğŸ’§", "ç«": "ğŸ”¥", "åœŸ": "ğŸ”ï¸"}[elem]
            st.metric(f"{icon} {elem}", f"{count} ä¸ª")

    # äº”è¡Œåˆ†æç»“æœ
    missing_text = "ã€".join(five_elements["missing"]) if five_elements["missing"] else "æ— "
    weak_text = "ã€".join(five_elements["weak"]) if five_elements["weak"] else "æ— "
    strong_text = "ã€".join(five_elements["strong"]) if five_elements["strong"] else "æ— "

    analysis_note = "ï¼ˆå«æ—¶è¾°å®Œæ•´åˆ†æï¼‰" if know_hour else "ï¼ˆç®€æ˜“åˆ†æï¼Œä¸å«æ—¶è¾°ï¼‰"

    st.markdown(f"""
    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; border-radius: 15px; color: white; margin: 15px 0;">
        <h4 style="margin:0 0 15px 0;">ğŸ”® äº”è¡Œç›ˆç¼ºåˆ†æ {analysis_note}</h4>
        <p style="margin:5px 0;"><b>âš ï¸ ç¼ºå°‘äº”è¡Œï¼š</b>{missing_text}</p>
        <p style="margin:5px 0;"><b>ğŸ“‰ åå¼±äº”è¡Œï¼š</b>{weak_text}</p>
        <p style="margin:5px 0;"><b>ğŸ“ˆ è¾ƒæ—ºäº”è¡Œï¼š</b>{strong_text}</p>
        <p style="margin:5px 0;"><b>ğŸ¯ æ—¥ä¸»äº”è¡Œï¼š</b>{five_elements["day_master"]}</p>
    </div>
    """, unsafe_allow_html=True)

    # äº”è¡Œè¡¥å……å»ºè®®
    if five_elements["missing"] or five_elements["weak"]:
        need_elements = five_elements["missing"] + five_elements["weak"]
        st.markdown("#### ğŸ’¡ äº”è¡Œè¡¥å……å»ºè®®")
        for elem in need_elements[:2]:  # æœ€å¤šæ˜¾ç¤ºä¸¤ä¸ª
            advice = ELEMENT_ADVICE.get(elem, {})
            st.info(f"**è¡¥{elem}**ï¼š{advice.get('è¡¥', '')}")
            st.info(f"ğŸ’ **æ¨èæ°´æ™¶**ï¼š{advice.get('æ°´æ™¶', '')}")

    # ç”Ÿå‘½çµæ•°è§£æ
    st.write("---")
    st.subheader(f"ğŸ”¢ {l_num} å·äººå‘½æ ¼è§£æ")
    st.markdown(f"""
    <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); padding: 20px; border-radius: 15px; color: white;">
        <h4 style="margin:0 0 10px 0;">âœ¨ {life_info['trait']}</h4>
        <p style="margin:10px 0; line-height:1.8;">{life_info['desc']}</p>
        <div style="background:rgba(255,255,255,0.2); padding:15px; border-radius:10px; margin-top:15px;">
            <p style="margin:0;"><b>ğŸ® 2026 é©¬å¹´è¿åŠ¿æŒ‡å¼•ï¼š</b></p>
            <p style="margin:10px 0 0 0; line-height:1.8;">{life_info['advice']}</p>
        </div>
    </div>
    """, unsafe_allow_html=True)

    # 2026 é©¬å¹´å¹¸è¿è‰²
    st.write("---")
    st.subheader("ğŸ¨ 2026 é©¬å¹´ä¸“å±å¹¸è¿è‰²")

    col1, col2 = st.columns(2)
    with col1:
        st.markdown(f"""
        <div style="background: #FFF5E6; padding: 20px; border-radius: 15px; border: 2px solid #FFB366;">
            <h4 style="margin:0 0 10px 0; color:#CC6600;">ğŸ® ç”Ÿè‚–ã€Œ{c_zodiac}ã€å¹¸è¿è‰²</h4>
            <p style="font-size:20px; font-weight:bold; color:#8B4513;">{'ã€'.join(zodiac_colors['colors'])}</p>
            <p style="font-size:12px; color:#666; margin:10px 0 0 0;">ğŸš« é¿å¼€ï¼š{zodiac_colors['avoid']}</p>
            <p style="font-size:11px; color:#888; margin:5px 0 0 0; line-height:1.5;"><i>{zodiac_colors['reason']}</i></p>
        </div>
        """, unsafe_allow_html=True)

    with col2:
        st.markdown(f"""
        <div style="background: #F0F5FF; padding: 20px; border-radius: 15px; border: 2px solid #6699FF;">
            <h4 style="margin:0 0 10px 0; color:#3366CC;">ğŸ”¢ çµæ•°ã€Œ{l_num}ã€å¹¸è¿è‰²</h4>
            <p style="font-size:20px; font-weight:bold; color:#333;">{'ã€'.join(life_colors['colors'])}</p>
            <p style="font-size:11px; color:#888; margin:10px 0 0 0; line-height:1.5;"><i>{life_colors['reason']}</i></p>
        </div>
        """, unsafe_allow_html=True)

    # é…æ¯”æ˜¾ç¤º
    st.write("---")
    st.subheader(f"ğŸ§ª ä¸“ä¸šé…æ¯”å»ºè®®ï¼š{selected_model}")
    r, total, df = model_data["ratios"], occ_data["total_oil"], 25
    c1, c2, c3 = st.columns(3)
    c1.metric("å‰è°ƒ", f"{round(total*r[0],2)}ml", f"{round(total*r[0]*df)}æ»´")
    c2.metric("ä¸­è°ƒ", f"{round(total*r[1],2)}ml", f"{round(total*r[1]*df)}æ»´")
    c3.metric("åè°ƒ", f"{round(total*r[2],2)}ml", f"{round(total*r[2]*df)}æ»´")

    st.balloons()
    if st.button("ğŸ”„ é‡æ–°å¼€å§‹åˆ†æ"):
        st.session_state.clear()
        st.rerun()
